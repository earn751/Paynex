<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HiGrip - ‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶â‡¶™‡¶æ‡¶∞‡ßç‡¶ú‡¶®</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fc; color: #1f2937; }
        .header-bg { background-image: linear-gradient(135deg, #0f172a 0%, #1e3a8a 100%); }
        .card-shadow { box-shadow: 0 5px 15px -3px rgba(0,0,0,0.1); }
        .bKash-color { background-color: #e2136e; }
        .Nagad-color { background-color: #f6941d; }
        .bKash-color-btn { @apply bg-pink-600 hover:bg-pink-700; }
        .Nagad-color-btn { @apply bg-yellow-600 hover:bg-yellow-700; }
    </style>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body class="min-h-screen flex flex-col">

    <div id="app" class="flex flex-col flex-grow hidden">
        <!-- Header -->
        <header class="header-bg text-white p-4 rounded-b-xl">
            <div class="flex items-center space-x-4">
                <img id="profile-pic" class="w-12 h-12 rounded-full border-2 border-yellow-400" src="" alt="User">
                <div class="flex-grow">
                    <p class="text-lg font-bold" id="user-name">Loading...</p>
                    <p class="text-xs text-gray-300" id="user-uid">UID: ...</p>
                </div>
            </div>
            <div class="mt-3 flex justify-between items-center">
                <div class="flex items-baseline space-x-1">
                    <span class="text-3xl font-extrabold text-yellow-300" id="user-coins">0</span>
                    <span class="text-sm">‡¶ï‡¶Ø‡¶º‡ßá‡¶®</span>
                </div>
                <div id="tier-badge" class="px-3 py-1 text-sm font-bold rounded-full bg-amber-800 text-white">Bronze</div>
            </div>
        </header>

        <main class="p-4 flex-grow overflow-y-auto">
            <!-- Earn Tab -->
            <div id="tab-earn">
                <h2 class="text-xl font-bold mb-4">‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶â‡¶™‡¶æ‡¶∞‡ßç‡¶ú‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</h2>

                <!-- Ad Watch -->
                <div class="bg-white p-5 rounded-xl card-shadow mb-6">
                    <div class="flex justify-between items-center mb-3">
                        <p class="text-lg font-semibold">‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</p>
                        <span class="text-green-600 font-bold">+10 ‡¶ï‡¶Ø‡¶º‡ßá‡¶®</span>
                    </div>
                    <button id="ad-button" class="w-full py-3 rounded-lg text-white font-bold bg-blue-600">‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®</button>
                    <div id="ad-cooldown" class="mt-3 text-center text-sm text-gray-600 hidden">
                        <div class="w-full bg-gray-200 rounded-full h-2.5 mb-1"><div id="progress" class="bg-red-600 h-2.5 rounded-full w-0"></div></div>
                        <span id="timer">‡ß¨‡ß¶ ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶¨‡¶æ‡¶ï‡¶ø</span>
                    </div>
                </div>

                <!-- Refer -->
                <div class="bg-white p-5 rounded-xl card-shadow">
                    <p class="text-lg font-semibold mb-3">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®</p>
                    <p class="text-sm text-gray-600 mb-4">‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá <strong>+50 ‡¶ï‡¶Ø‡¶º‡ßá‡¶®</strong></p>
                    <div class="flex items-center justify-between bg-gray-100 p-3 rounded-lg mb-4">
                        <p class="text-sm truncate" id="ref-link">t.me/HiGriP_bot?start=ref_...</p>
                        <button id="copy-btn" class="text-blue-600 font-bold text-sm">‡¶ï‡¶™‡¶ø</button>
                    </div>
                    <p class="text-sm">‡¶∞‡ßá‡¶´‡¶æ‡¶∞: <strong id="ref-count">0</strong> ‡¶ú‡¶®</p>
                    <p id="ref-lock" class="text-xs text-red-600 mt-2 hidden">‡¶∞‡¶ø‡¶°‡¶ø‡¶Æ‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶∞‡¶ì <span id="needed">5</span> ‡¶ú‡¶® ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá</p>
                </div>
            </div>

            <!-- Redeem Tab -->
            <div id="tab-redeem" class="hidden">
                <h2 class="text-xl font-bold mb-4">‡¶∞‡¶ø‡¶°‡¶ø‡¶Æ ‡¶ï‡¶∞‡ßÅ‡¶®</h2>
                <div class="space-y-4">
                    <!-- bKash -->
                    <div class="bg-gradient-to-r from-pink-600 to-pink-700 text-white p-4 rounded-xl card-shadow">
                        <p class="text-4xl font-bold text-center">‡ß≥100</p>
                        <p class="text-center text-sm">1,000 ‡¶ï‡¶Ø‡¶º‡ßá‡¶®</p>
                        <button data-amount="100" data-coins="1000" data-type="bKash" class="redeem-btn w-full mt-3 bg-white text-pink-700 font-bold py-2 rounded-lg">‡¶∞‡¶ø‡¶°‡¶ø‡¶Æ</button>
                    </div>
                    <!-- Nagad -->
                    <div class="bg-gradient-to-r from-yellow-600 to-yellow-700 text-white p-4 rounded-xl card-shadow">
                        <p class="text-4xl font-bold text-center">‡ß≥100</p>
                        <p class="text-center text-sm">1,000 ‡¶ï‡¶Ø‡¶º‡ßá‡¶®</p>
                        <button data-amount="100" data-coins="1000" data-type="Nagad" class="redeem-btn w-full mt-3 bg-white text-yellow-700 font-bold py-2 rounded-lg">‡¶∞‡¶ø‡¶°‡¶ø‡¶Æ</button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Nav -->
        <nav class="bg-white border-t border-gray-200 sticky bottom-0">
            <div class="flex justify-around py-2">
                <button data-tab="redeem" class="nav-btn text-gray-600">
                    <svg class="w-6 h-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M12 8c-2.485 0-4 .933-4 2.5v.5H7a2 2 0 00-2 2v3a2 2 0 002 2h10a2 2 0 002-2v-3a2 2 0 00-2-2h-1v-.5c0-1.567-1.515-2.5-4-2.5z"/></svg>
                    <span class="text-xs">‡¶∞‡¶ø‡¶°‡¶ø‡¶Æ</span>
                </button>
                <button data-tab="earn" class="nav-btn text-blue-600">
                    <svg class="w-6 h-6 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"/><path d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"/></svg>
                    <span class="text-xs">‡¶â‡¶™‡¶æ‡¶∞‡ßç‡¶ú‡¶®</span>
                </button>
            </div>
        </nav>
    </div>

    <!-- Redeem Modal -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-70 hidden flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl p-6 w-full max-w-sm">
            <h3 class="text-xl font-bold mb-4" id="modal-title">bKash ‡¶∞‡¶ø‡¶°‡¶ø‡¶Æ</h3>
            <p class="text-sm mb-4">‡ß≥<span id="modal-amount">100</span> ‡¶™‡ßá‡¶§‡ßá ‡ßß‡ßß ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶®</p>
            <input type="text" id="phone" placeholder="01XXXXXXXXX" class="w-full p-3 border rounded-lg mb-4" maxlength="11">
            <div class="flex space-x-3">
                <button id="cancel-btn" class="flex-1 py-2 bg-gray-300 rounded-lg font-bold">‡¶¨‡¶æ‡¶§‡¶ø‡¶≤</button>
                <button id="submit-btn" class="flex-1 py-2 bg-green-600 text-white rounded-lg font-bold">‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
            </div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand();

        const user = tg.initDataUnsafe?.user || { id: Date.now(), first_name: '‡¶ü‡ßá‡¶∏‡ßç‡¶ü' };
        const uid = user.id.toString();
        const STORAGE_KEY = `higrip_${uid}`;

        // Load from localStorage
        const saved = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {
            coins: 0,
            referrals: [],
            lastAd: 0
        };

        let state = {
            coins: saved.coins,
            referrals: saved.referrals,
            lastAd: saved.lastAd,
            get refCount() { return this.referrals.length; }
        };

        // Save to localStorage
        const save = () => localStorage.setItem(STORAGE_KEY, JSON.stringify({
            coins: state.coins,
            referrals: state.referrals,
            lastAd: state.lastAd
        }));

        // UI Elements
        const els = {
            coins: document.getElementById('user-coins'),
            name: document.getElementById('user-name'),
            uid: document.getElementById('user-uid'),
            pic: document.getElementById('profile-pic'),
            refLink: document.getElementById('ref-link'),
            refCount: document.getElementById('ref-count'),
            refLock: document.getElementById('ref-lock'),
            needed: document.getElementById('needed'),
            tier: document.getElementById('tier-badge'),
            adBtn: document.getElementById('ad-button'),
            cooldown: document.getElementById('ad-cooldown'),
            progress: document.getElementById('progress'),
            timer: document.getElementById('timer'),
            modal: document.getElementById('modal'),
            modalTitle: document.getElementById('modal-title'),
            modalAmount: document.getElementById('modal-amount'),
            phone: document.getElementById('phone'),
            submit: document.getElementById('submit-btn'),
            cancel: document.getElementById('cancel-btn')
        };

        // Init UI
        els.name.textContent = user.first_name || '‡¶á‡¶â‡¶ú‡¶æ‡¶∞';
        els.uid.textContent = `UID: ${uid.slice(-6)}`;
        els.pic.src = user.photo_url || `https://ui-avatars.com/api/?name=${user.first_name}&background=6b7280&color=fff`;
        els.refLink.textContent = `t.me/HiGriP_bot?start=ref_${uid}`;
        updateUI();

        // Check referral from URL
        const urlRef = new URLSearchParams(location.search).get('start')?.replace('ref_', '');
        if (urlRef && urlRef !== uid && !state.referrals.includes(urlRef)) {
            state.referrals.push(urlRef);
            state.coins += 50;
            save();
            tg.showAlert('‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶∏‡¶´‡¶≤! +50 ‡¶ï‡¶Ø‡¶º‡ßá‡¶®');
        }

        function updateUI() {
            els.coins.textContent = state.coins.toLocaleString();
            els.refCount.textContent = state.refCount;
            const needed = Math.max(0, 5 - state.refCount);
            if (needed > 0) {
                els.refLock.classList.remove('hidden');
                els.needed.textContent = needed;
            } else {
                els.refLock.classList.add('hidden');
            }
            const tier = state.coins >= 5000 ? 'Gold' : state.coins >= 1000 ? 'Silver' : 'Bronze';
            els.tier.textContent = `${tier} Tier`;
            els.tier.className = `px-3 py-1 text-sm font-bold rounded-full ${tier === 'Gold' ? 'bg-yellow-500 text-black' : tier === 'Silver' ? 'bg-gray-400' : 'bg-amber-800'} text-white`;

            document.querySelectorAll('.redeem-btn').forEach(btn => {
                const req = parseInt(btn.dataset.coins);
                if (state.refCount < 5) {
                    btn.disabled = true; btn.textContent = '‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶≤‡¶ï';
                } else if (state.coins < req) {
                    btn.disabled = true; btn.textContent = '‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶ï‡¶Æ';
                } else {
                    btn.disabled = false; btn.textContent = '‡¶∞‡¶ø‡¶°‡¶ø‡¶Æ';
                }
            });

            save();
        }

        // Ad Watch
        els.adBtn.onclick = () => {
            if (Date.now() - state.lastAd < 60000) {
                startCooldown();
                return;
            }
            els.adBtn.disabled = true;
            els.adBtn.textContent = '‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶ö‡¶≤‡¶õ‡ßá...';
            setTimeout(() => {
                state.coins += 10;
                state.lastAd = Date.now();
                updateUI();
                els.adBtn.textContent = '‡¶¨‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶™‡¶® ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®';
                els.adBtn.disabled = false;
                tg.showAlert('+10 ‡¶ï‡¶Ø‡¶º‡ßá‡¶® ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
                startCooldown();
            }, 5000);
        };

        function startCooldown() {
            els.cooldown.classList.remove('hidden');
            const start = state.lastAd;
            const interval = setInterval(() => {
                const left = 60 - Math.floor((Date.now() - start) / 1000);
                if (left <= 0) {
                    clearInterval(interval);
                    els.cooldown.classList.add('hidden');
                    els.adBtn.disabled = false;
                    return;
                }
                els.timer.textContent = `${left} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶¨‡¶æ‡¶ï‡¶ø`;
                els.progress.style.width = `${(60 - left) * 1.666}%`;
            }, 100);
        }

        // Redeem
        let redeemData = {};
        document.querySelectorAll('.redeem-btn').forEach(btn => {
            btn.onclick = () => {
                if (btn.disabled) return;
                redeemData = {
                    type: btn.dataset.type,
                    amount: btn.dataset.amount,
                    coins: btn.dataset.coins
                };
                els.modalTitle.textContent = `${redeemData.type} ‡¶∞‡¶ø‡¶°‡¶ø‡¶Æ`;
                els.modalAmount.textContent = redeemData.amount;
                els.phone.value = '';
                els.modal.classList.remove('hidden');
            };
        });

        els.cancel.onclick = () => els.modal.classList.add('hidden');
        els.submit.onclick = () => {
            const phone = els.phone.value.trim();
            if (!/^\d{11}$/.test(phone)) {
                tg.showAlert('‡ßß‡ßß ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶®');
                return;
            }
            state.coins -= parseInt(redeemData.coins);
            updateUI();
            els.modal.classList.add('hidden');

            // Send to Admin via Telegram
            const msg = encodeURIComponent(
                `*‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡¶ø‡¶°‡¶ø‡¶Æ ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü*\n\n` +
                `üë§ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞: ${user.first_name} (${uid})\n` +
                `üí∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£: ‡ß≥${redeemData.amount}\n` +
                `üì± ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞: ${phone}\n` +
                `üíé ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ${state.coins} ‡¶ï‡¶Ø‡¶º‡ßá‡¶®`
            );
            window.open(`https://t.me/YourAdminBot?text=${msg}`, '_blank');
            tg.showAlert('‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡ß®‡ß™ ‡¶ò‡¶£‡ßç‡¶ü‡¶æ‡¶Ø‡¶º ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡•§');
        };

        // Copy Link
        document.getElementById('copy-btn').onclick = () => {
            navigator.clipboard.writeText(els.refLink.textContent).then(() => {
                tg.showAlert('‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            });
        };

        // Tab Switch
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.onclick = () => {
                document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('text-blue-600'));
                btn.classList.add('text-blue-600');
                document.getElementById('tab-earn').classList.toggle('hidden', btn.dataset.tab !== 'earn');
                document.getElementById('tab-redeem').classList.toggle('hidden', btn.dataset.tab !== 'redeem');
            };
        });

        // Show App
        document.getElementById('app').classList.remove('hidden');
        if (Date.now() - state.lastAd < 60000) startCooldown();
    </script>
</body>
</html>
