<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HiGrip - Mobile Offer Rewards</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --primary-color: #0088cc;
            --secondary-color: #f0f0f0;
            --accent-color: #ff9500;
            --text-color: #333;
            --light-text: #fff;
            --border-radius: 10px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: var(--text-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .tagline {
            font-size: 14px;
            color: #666;
        }
        
        .card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--box-shadow);
        }
        
        .card-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        select, input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 16px;
        }
        
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 12px 20px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #0077b3;
        }
        
        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .btn-accent {
            background-color: var(--accent-color);
        }
        
        .btn-accent:hover {
            background-color: #e68500;
        }
        
        .offer-card {
            border-left: 4px solid var(--accent-color);
            margin-bottom: 15px;
            padding: 15px;
            background-color: #f9f9f9;
        }
        
        .offer-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .offer-details {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .requirements {
            font-size: 12px;
            color: #888;
            margin-bottom: 10px;
        }
        
        .progress-container {
            margin: 20px 0;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .progress-bar {
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--accent-color);
            width: 0%;
            transition: width 0.5s;
        }
        
        .timer {
            text-align: center;
            font-size: 14px;
            color: #666;
            margin-top: 10px;
        }
        
        .history-item {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .history-date {
            font-size: 12px;
            color: #888;
        }
        
        .status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .status-completed {
            background-color: #e6f7ee;
            color: #00a65a;
        }
        
        .status-pending {
            background-color: #fff8e6;
            color: #ffa500;
        }
        
        .hidden {
            display: none;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .notification.show {
            opacity: 1;
        }
        
        .ad-container {
            background-color: #333;
            color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            text-align: center;
            margin: 20px 0;
        }
        
        .ad-text {
            margin-bottom: 15px;
        }
        
        .close-ad {
            background-color: transparent;
            border: 1px solid white;
            color: white;
            padding: 5px 10px;
            border-radius: var(--border-radius);
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">HiGrip</div>
            <div class="tagline">Get Mobile Data Offers & Rewards</div>
        </header>
        
        <div class="card">
            <div class="card-title">Join Our Channel</div>
            <p>You must join our Telegram channel to use this app:</p>
            <a href="https://t.me/HiGripGo" target="_blank" class="btn" style="margin-top: 10px; text-decoration: none; display: inline-block;">
                Join HiGripGo Channel
            </a>
            <button id="checkJoin" class="btn btn-accent" style="margin-top: 10px;">Check if Joined</button>
        </div>
        
        <div class="card" id="mainSection" style="display: none;">
            <div class="card-title">Enter Your Mobile Number</div>
            <div class="input-group">
                <label for="operator">Select Operator</label>
                <select id="operator">
                    <option value="">Select Operator</option>
                    <option value="banglalink">Banglalink</option>
                    <option value="airtel">Airtel</option>
                    <option value="robi">Robi</option>
                    <option value="grameenphone">Grameenphone</option>
                </select>
            </div>
            <div class="input-group">
                <label for="phoneNumber">Phone Number</label>
                <input type="text" id="phoneNumber" placeholder="01XXXXXXXXX">
            </div>
            <button id="checkOffer" class="btn">Check Offers</button>
        </div>
        
        <div class="card" id="offersSection" style="display: none;">
            <div class="card-title">Available Offers</div>
            <div id="offersList">
                <!-- Offers will be dynamically inserted here -->
            </div>
        </div>
        
        <div class="card" id="adSection">
            <div class="card-title">Watch Ads to Unlock Rewards</div>
            <div class="progress-container">
                <div class="progress-label">
                    <span>Progress</span>
                    <span id="progressText">0/5</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            <div class="timer" id="timer">Next ad available in: 1:00</div>
            <button id="watchAd" class="btn btn-accent" disabled>Watch Ad</button>
        </div>
        
        <div class="card">
            <div class="card-title">Ad Watch History</div>
            <div id="historyList">
                <!-- History items will be dynamically inserted here -->
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">Notification message</div>
    
    <div class="ad-container" id="adPopup" style="display: none;">
        <div class="ad-text">Advertisement - Please watch till the end</div>
        <div id="adCountdown">Ad will complete in 10 seconds</div>
        <button class="close-ad" id="closeAd">Close Ad</button>
    </div>

    <script>
        // Telegram Web App initialization
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();
        
        // DOM Elements
        const checkJoinBtn = document.getElementById('checkJoin');
        const mainSection = document.getElementById('mainSection');
        const checkOfferBtn = document.getElementById('checkOffer');
        const offersSection = document.getElementById('offersSection');
        const offersList = document.getElementById('offersList');
        const watchAdBtn = document.getElementById('watchAd');
        const timerElement = document.getElementById('timer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const historyList = document.getElementById('historyList');
        const notification = document.getElementById('notification');
        const adPopup = document.getElementById('adPopup');
        const closeAdBtn = document.getElementById('closeAd');
        const adCountdown = document.getElementById('adCountdown');
        
        // App State
        let userJoinedChannel = false;
        let adProgress = 0;
        let adTimer = 60; // 60 seconds = 1 minute
        let timerInterval;
        let adCountdownValue = 10;
        let adCountdownInterval;
        
        // Sample offers data
        const offers = {
            banglalink: [
                { id: 1, title: "5GB Data Offer", details: "5GB for 7 days", requirements: "Must have active SIM for 3 months", data: "5GB" },
                { id: 2, title: "10GB Data Offer", details: "10GB for 15 days", requirements: "Must have balance > 10 Taka", data: "10GB" },
                { id: 3, title: "15GB Data Offer", details: "15GB for 30 days", requirements: "Must use 1GB in last month", data: "15GB" }
            ],
            airtel: [
                { id: 4, title: "3GB Data Offer", details: "3GB for 5 days", requirements: "New customer offer", data: "3GB" },
                { id: 5, title: "8GB Data Offer", details: "8GB for 10 days", requirements: "Must have active SIM for 1 month", data: "8GB" },
                { id: 6, title: "12GB Data Offer", details: "12GB for 20 days", requirements: "Must have balance > 20 Taka", data: "12GB" }
            ],
            robi: [
                { id: 7, title: "4GB Data Offer", details: "4GB for 7 days", requirements: "Special weekend offer", data: "4GB" },
                { id: 8, title: "9GB Data Offer", details: "9GB for 14 days", requirements: "Must use 500MB in last week", data: "9GB" },
                { id: 9, title: "18GB Data Offer", details: "18GB for 30 days", requirements: "Must have active SIM for 6 months", data: "18GB" }
            ],
            grameenphone: [
                { id: 10, title: "6GB Data Offer", details: "6GB for 10 days", requirements: "New customer special", data: "6GB" },
                { id: 11, title: "11GB Data Offer", details: "11GB for 15 days", requirements: "Must have balance > 15 Taka", data: "11GB" },
                { id: 12, title: "20GB Data Offer", details: "20GB for 30 days", requirements: "Must use 2GB in last month", data: "20GB" }
            ]
        };
        
        // Sample history data
        let adHistory = [
            { date: "2023-10-15 14:30", status: "Completed" },
            { date: "2023-10-15 13:45", status: "Completed" },
            { date: "2023-10-15 12:15", status: "Pending" }
        ];
        
        // Initialize the app
        function initApp() {
            // Check if user has joined the channel (simulated)
            // In a real app, you would check via Telegram API
            checkJoinBtn.addEventListener('click', checkChannelJoin);
            checkOfferBtn.addEventListener('click', checkOffers);
            watchAdBtn.addEventListener('click', showAd);
            closeAdBtn.addEventListener('click', closeAd);
            
            // Load history
            renderHistory();
            
            // Start the timer for ads
            startAdTimer();
        }
        
        // Check if user joined the channel
        function checkChannelJoin() {
            // In a real app, you would use Telegram API to check channel membership
            // For demo purposes, we'll simulate a successful join
            userJoinedChannel = true;
            showNotification("Successfully verified channel membership!");
            mainSection.style.display = 'block';
            checkJoinBtn.disabled = true;
            checkJoinBtn.textContent = "Channel Joined ✓";
        }
        
        // Check available offers based on phone number
        function checkOffers() {
            const operator = document.getElementById('operator').value;
            const phoneNumber = document.getElementById('phoneNumber').value;
            
            if (!operator) {
                showNotification("Please select an operator");
                return;
            }
            
            if (!phoneNumber || phoneNumber.length !== 11) {
                showNotification("Please enter a valid 11-digit phone number");
                return;
            }
            
            // Show offers for the selected operator
            const operatorOffers = offers[operator] || [];
            renderOffers(operatorOffers);
            offersSection.style.display = 'block';
            
            showNotification(`Offers loaded for ${operator}`);
        }
        
        // Render offers to the UI
        function renderOffers(offers) {
            offersList.innerHTML = '';
            
            if (offers.length === 0) {
                offersList.innerHTML = '<p>No offers available for this number.</p>';
                return;
            }
            
            offers.forEach(offer => {
                const offerElement = document.createElement('div');
                offerElement.className = 'offer-card';
                offerElement.innerHTML = `
                    <div class="offer-title">${offer.title}</div>
                    <div class="offer-details">${offer.details}</div>
                    <div class="requirements">Requirements: ${offer.requirements}</div>
                    <button class="btn claim-btn" data-id="${offer.id}">Claim Now</button>
                `;
                offersList.appendChild(offerElement);
            });
            
            // Add event listeners to claim buttons
            document.querySelectorAll('.claim-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const offerId = this.getAttribute('data-id');
                    claimOffer(offerId);
                });
            });
        }
        
        // Claim an offer
        function claimOffer(offerId) {
            // In a real app, you would process the offer claim
            showNotification(`Offer ${offerId} claimed successfully!`);
        }
        
        // Show ad popup
        function showAd() {
            if (watchAdBtn.disabled) return;
            
            // Reset ad countdown
            adCountdownValue = 10;
            adCountdown.textContent = `Ad will complete in ${adCountdownValue} seconds`;
            
            // Show ad popup
            adPopup.style.display = 'block';
            
            // Start countdown
            adCountdownInterval = setInterval(() => {
                adCountdownValue--;
                adCountdown.textContent = `Ad will complete in ${adCountdownValue} seconds`;
                
                if (adCountdownValue <= 0) {
                    clearInterval(adCountdownInterval);
                    completeAd();
                }
            }, 1000);
        }
        
        // Close ad (if user closes early)
        function closeAd() {
            clearInterval(adCountdownInterval);
            adPopup.style.display = 'none';
            showNotification("Ad closed early - no reward given");
        }
        
        // Complete watching ad
        function completeAd() {
            clearInterval(adCountdownInterval);
            adPopup.style.display = 'none';
            
            // Update progress
            adProgress++;
            updateProgress();
            
            // Add to history
            const now = new Date();
            const dateStr = `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            adHistory.unshift({ date: dateStr, status: "Completed" });
            renderHistory();
            
            // Reset timer
            resetAdTimer();
            
            showNotification("Ad completed! Progress updated.");
        }
        
        // Update progress bar and text
        function updateProgress() {
            const progressPercentage = (adProgress / 5) * 100;
            progressFill.style.width = `${progressPercentage}%`;
            progressText.textContent = `${adProgress}/5`;
            
            if (adProgress >= 5) {
                showNotification("Congratulations! You've unlocked all rewards!");
            }
        }
        
        // Start the ad timer
        function startAdTimer() {
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                adTimer--;
                updateTimerDisplay();
                
                if (adTimer <= 0) {
                    watchAdBtn.disabled = false;
                    watchAdBtn.textContent = "Watch Ad";
                    timerElement.textContent = "Ad available now!";
                }
            }, 1000);
        }
        
        // Update timer display
        function updateTimerDisplay() {
            const minutes = Math.floor(adTimer / 60);
            const seconds = adTimer % 60;
            timerElement.textContent = `Next ad available in: ${minutes}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // Reset ad timer after watching an ad
        function resetAdTimer() {
            adTimer = 60; // 1 minute
            watchAdBtn.disabled = true;
            updateTimerDisplay();
        }
        
        // Render ad watch history
        function renderHistory() {
            historyList.innerHTML = '';
            
            if (adHistory.length === 0) {
                historyList.innerHTML = '<p>No ad watch history yet.</p>';
                return;
            }
            
            adHistory.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                const statusClass = item.status === 'Completed' ? 'status-completed' : 'status-pending';
                
                historyItem.innerHTML = `
                    <div>${item.date}</div>
                    <div class="history-date">
                        Status: <span class="status ${statusClass}">${item.status}</span>
                    </div>
                `;
                
                historyList.appendChild(historyItem);
            });
        }
        
        // Show notification
        function showNotification(message) {
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
