<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PayNex - Telegram Mini App</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #0088cc;
      --primary-dark: #006da3;
      --secondary: #121c36;
      --accent: #00c2ff;
      --success: #00d66c;
      --warning: #ff9500;
      --danger: #ff3b30;
      --text: #ffffff;
      --text-secondary: #b0b0b0;
      --card-bg: #1a243b;
      --input-bg: #23304d;
      --overlay: rgba(0, 0, 0, 0.7);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Arial, sans-serif;
    }

    body {
      background: linear-gradient(135deg, var(--secondary) 0%, #0d1425 100%);
      color: var(--text);
      min-height: 100vh;
      padding-bottom: 80px;
    }

    /* Spinner Styles */
    .spinner-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--secondary);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      opacity: 1;
      transition: opacity 0.5s ease;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid var(--primary);
      border-top: 5px solid var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    header {
      padding: 15px 20px;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: bold;
      font-size: 20px;
    }

    .logo i {
      font-size: 24px;
    }

    .header-actions {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .notification-btn {
      background: none;
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
      position: relative;
    }

    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--danger);
      color: white;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid white;
    }

    .content {
      padding: 20px;
    }

    .section-title {
      margin-bottom: 15px;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-title i {
      color: var(--accent);
    }

    .card {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .hero-section {
      text-align: center;
      padding: 20px 0;
    }

    .hero-slider {
      position: relative;
      width: 100%;
      max-width: 300px;
      margin: 0 auto 15px;
      overflow: hidden;
    }

    .slider-images {
      display: flex;
      width: 100%;
    }

    .slider-image {
      width: 100%;
      max-width: 300px;
      border-radius: 15px;
      display: none;
    }

    .slider-image.active {
      display: block;
    }

    .hero-title {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
      color: var(--accent);
    }

    .balance-amount {
      font-size: 32px;
      font-weight: bold;
      margin: 10px 0;
      color: var(--success);
    }

    .task-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-top: 20px;
    }

    .task-item {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      border-radius: 12px;
      padding: 15px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .task-number {
      position: absolute;
      top: 5px;
      right: 5px;
      background: rgba(255, 255, 255, 0.2);
      width: 25px;
      height: 25px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }

    .task-icon {
      font-size: 30px;
      margin-bottom: 10px;
    }

    .task-title {
      font-size: 14px;
      margin-bottom: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }

    .task-reward {
      font-size: 12px;
      color: var(--success);
      font-weight: bold;
    }

    .task-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .task-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .task-btn.completed {
      background: var(--success);
    }

    .stats-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-top: 20px;
    }

    .stat-card {
      background: linear-gradient(135deg, #23304d 0%, #1a243b 100%);
      border-radius: 12px;
      padding: 15px;
      text-align: center;
    }

    .stat-value {
      font-size: 24px;
      font-weight: bold;
      margin: 5px 0;
      color: var(--accent);
    }

    .stat-label {
      font-size: 12px;
      color: var(--text-secondary);
    }

    .referral-link {
      display: flex;
      margin: 15px 0;
    }

    .referral-link input {
      flex: 1;
      padding: 12px 15px;
      border-radius: 8px 0 0 8px;
      border: none;
      background: var(--input-bg);
      color: var(--text);
    }

    .copy-btn {
      background: var(--primary);
      border: none;
      color: white;
      padding: 0 15px;
      border-radius: 0 8px 8px 0;
      cursor: pointer;
    }

    .share-buttons {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 20px;
    }

    .share-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: var(--input-bg);
      border: none;
      border-radius: 10px;
      padding: 10px;
      color: var(--text);
      cursor: pointer;
      transition: all 0.3s;
    }

    .share-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
    }

    .share-btn i {
      font-size: 24px;
      margin-bottom: 5px;
    }

    .share-btn.facebook i {
      color: #1877f2;
    }

    .share-btn.whatsapp i {
      color: #25d366;
    }

    .share-btn.messenger i {
      color: #006aff;
    }

    .profile-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .profile-avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid var(--primary);
      margin: 0 auto 15px;
    }

    .profile-name {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .profile-username {
      color: var(--text-secondary);
      margin-bottom: 10px;
    }

    .profile-id {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 15px;
    }

    .profile-tagline {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      padding: 8px 15px;
      border-radius: 20px;
      display: inline-block;
      font-size: 14px;
      margin-bottom: 20px;
    }

    .withdraw-section, .admin-section {
      margin-top: 20px;
    }

    .withdraw-header, .admin-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
      cursor: pointer;
    }

    .withdraw-content, .admin-content {
      display: none;
    }

    .withdraw-content.active, .admin-content.active {
      display: block;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-size: 14px;
    }

    .form-control {
      width: 100%;
      padding: 12px 15px;
      border-radius: 8px;
      border: 1px solid var(--input-bg);
      background: var(--input-bg);
      color: var(--text);
    }

    .submit-btn {
      background: var(--primary);
      border: none;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      width: 100%;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .submit-btn:hover {
      background: var(--primary-dark);
    }

    .submit-btn:disabled {
      background: var(--text-secondary);
      cursor: not-allowed;
    }

    .min-withdraw-info {
      text-align: center;
      margin: 15px 0;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .policy-section {
      margin-top: 20px;
    }

    .policy-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
      cursor: pointer;
    }

    .policy-content {
      display: none;
    }

    .policy-content.active {
      display: block;
    }

    .policy-list {
      padding-left: 20px;
    }

    .policy-list li {
      margin-bottom: 10px;
      line-height: 1.4;
    }

    nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: space-around;
      background: var(--card-bg);
      padding: 12px 0;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    }

    .nav-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .nav-btn i {
      font-size: 20px;
      margin-bottom: 5px;
    }

    .nav-btn.active {
      color: var(--primary);
    }

    .hidden {
      display: none;
    }

    .notification-panel {
      position: fixed;
      top: 0;
      right: -300px;
      width: 300px;
      height: 100%;
      background: var(--card-bg);
      z-index: 1000;
      padding: 20px;
      overflow-y: auto;
      transition: right 0.3s ease;
    }

    .notification-panel.active {
      right: 0;
    }

    .notification-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--input-bg);
    }

    .close-notifications {
      background: none;
      border: none;
      color: var(--text);
      font-size: 20px;
      cursor: pointer;
    }

    .notification-item {
      padding: 15px;
      background: var(--input-bg);
      border-radius: 10px;
      margin-bottom: 15px;
    }

    .notification-title {
      font-weight: bold;
      margin-bottom: 5px;
      color: var(--accent);
    }

    .notification-message {
      font-size: 14px;
      margin-bottom: 5px;
      color: var(--text);
    }

    .notification-time {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 5px;
    }

    .vote-buttons {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .vote-btn {
      background: var(--primary);
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
    }

    .vote-btn:hover {
      background: var(--primary-dark);
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--overlay);
      z-index: 999;
      display: none;
    }

    .overlay.active {
      display: block;
    }

    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      background: var(--success);
      opacity: 0;
      z-index: 1000;
      pointer-events: none;
    }

    @keyframes confettiFall {
      0% {
        transform: translateY(-100px) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(1000px) rotate(720deg);
        opacity: 0;
      }
    }

    .referral-stats {
      display: flex;
      justify-content: space-between;
      margin: 15px 0;
      padding: 10px;
      background: var(--input-bg);
      border-radius: 10px;
    }

    .referral-stats .stat {
      text-align: center;
    }

    .referral-stats .stat-value {
      font-size: 18px;
      font-weight: bold;
      color: var(--success);
      display: block;
    }

    .referral-stats .stat-label {
      font-size: 12px;
      color: var(--text-secondary);
    }

    @media (max-width: 480px) {
      .task-grid {
        grid-template-columns: 1fr;
      }

      .stats-container {
        grid-template-columns: 1fr;
      }

      .share-buttons {
        grid-template-columns: repeat(2, 1fr);
      }

      .notification-panel {
        width: 85%;
        right: -85%;
      }
    }
  </style>
</head>
<body>
  <!-- Spinner Overlay -->
  <div class="spinner-overlay" id="spinnerOverlay">
    <div class="spinner"></div>
  </div>

  <header>
    <div class="logo">
      <i class="fas fa-wallet"></i>
      <span>PayNex</span>
    </div>
    <div class="header-actions">
      <button class="notification-btn" onclick="toggleNotifications()">
        <i class="fas fa-bell"></i>
        <span class="notification-badge" id="notificationBadge">0</span>
      </button>
      <img id="userAvatar" class="user-avatar" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="User">
    </div>
  </header>

  <div class="content">
    <!-- Home Page -->
    <div id="homePage">
      <div class="card">
        <div class="hero-section">
          <div class="hero-slider" id="heroSlider">
            <div class="slider-images" id="sliderImages"></div>
          </div>
          <h1 class="hero-title">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶Ø‡¶º ‡¶¨‡ßÉ‡¶¶‡ßç‡¶ß‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</h1>
          <div class="balance-amount">‡ß≥<span id="totalBalance">0</span></div>
          <div class="stats-container">
            <div class="stat-card">
              <div class="stat-label">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ</div>
              <div class="stat-value">‡ß≥<span id="taskIncome">0</span></div>
            </div>
            <div class="stat-card">
              <div class="stat-label">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ</div>
              <div class="stat-value">‡ß≥<span id="refIncomeDetail">0</span></div>
            </div>
            <div class="stat-card">
              <div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</div>
              <div class="stat-value">‡ß≥<span id="totalWithdraw">0</span></div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <h2 class="section-title">
          <i class="fas fa-fire"></i>
          ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï
        </h2>
        <div class="task-grid" id="liveTasks"></div>

        <h2 class="section-title">
          <i class="fas fa-tasks"></i>
          ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï
        </h2>
        <div class="category-section">
          <div class="category-header" onclick="toggleCategory('registration')">
            <h3 class="section-title">
              <i class="fas fa-user-plus"></i>
              ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡ßá ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ
            </h3>
            <i class="fas fa-chevron-down" id="registrationArrow"></i>
          </div>
          <div class="category-content" id="registrationContent">
            <div class="task-grid" id="registrationTasks"></div>
          </div>
        </div>
        <div class="category-section">
          <div class="category-header" onclick="toggleCategory('appDownload')">
            <h3 class="section-title">
              <i class="fas fa-download"></i>
              ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßá ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ
            </h3>
            <i class="fas fa-chevron-down" id="appDownloadArrow"></i>
          </div>
          <div class="category-content" id="appDownloadContent">
            <div class="task-grid" id="appDownloadTasks"></div>
          </div>
        </div>
        <div class="category-section">
          <div class="category-header" onclick="toggleCategory('survey')">
            <h3 class="section-title">
              <i class="fas fa-poll"></i>
              ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡ßá ‡¶ï‡¶∞‡ßá ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ
            </h3>
            <i class="fas fa-chevron-down" id="surveyArrow"></i>
          </div>
          <div class="category-content" id="surveyContent">
            <div class="task-grid" id="surveyTasks"></div>
          </div>
        </div>
        <div class="category-section">
          <div class="category-header" onclick="toggleCategory('socialMedia')">
            <h3 class="section-title">
              <i class="fas fa-thumbs-up"></i>
              ‡¶∏‡ßã‡¶∂‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶Æ‡¶ø‡¶°‡¶ø‡ßü‡¶æ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï
            </h3>
            <i class="fas fa-chevron-down" id="socialMediaArrow"></i>
          </div>
          <div class="category-content" id="socialMediaContent">
            <div class="task-grid" id="socialMediaTasks"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Refer Page -->
    <div id="referPage" class="hidden">
      <div class="card">
        <h2 class="section-title">
          <i class="fas fa-user-friends"></i>
          Referral System
        </h2>

        <div class="referral-stats">
          <div class="stat">
            <span class="stat-value" id="refCount">0</span>
            <span class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶∞‡ßá‡¶´‡¶æ‡¶∞</span>
          </div>
          <div class="stat">
            <span class="stat-value">‡ß≥<span id="refIncome">0</span></span>
            <span class="stat-label">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ</span>
          </div>
          <div class="stat">
            <span class="stat-value" id="refLevel">1</span>
            <span class="stat-label">‡¶≤‡ßá‡¶≠‡ßá‡¶≤</span>
          </div>
        </div>

        <p style="text-align: center; margin: 15px 0; color: var(--success); font-weight: bold;">
          ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤‡ßá ‡ß≥25 ‡¶™‡¶æ‡¶®! üî•
        </p>

        <div class="referral-link">
          <input id="refLink" type="text" readonly placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...">
          <button class="copy-btn" onclick="copyRef()">
            <i class="fas fa-copy"></i>
          </button>
        </div>

        <div style="text-align: center; margin: 10px 0; color: var(--text-secondary); font-size: 12px;">
          ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá
        </div>

        <div class="share-buttons">
          <button class="share-btn facebook" onclick="shareOnFacebook()" title="Facebook ‡¶è ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞">
            <i class="fab fa-facebook"></i>
            <span>Facebook</span>
          </button>
          <button class="share-btn whatsapp" onclick="shareOnWhatsApp()" title="WhatsApp ‡¶è ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞">
            <i class="fab fa-whatsapp"></i>
            <span>WhatsApp</span>
          </button>
          <button class="share-btn messenger" onclick="shareOnMessenger()" title="Messenger ‡¶è ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞">
            <i class="fab fa-facebook-messenger"></i>
            <span>Messenger</span>
          </button>
        </div>

        <div style="margin-top: 20px; padding: 15px; background: var(--input-bg); border-radius: 10px; text-align: center;">
          <h4 style="color: var(--accent); margin-bottom: 10px;">üìà ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡ßá‡¶≠‡ßá‡¶≤</h4>
          <p style="color: var(--text-secondary); font-size: 14px;">
            <strong id="levelInfo">‡¶≤‡ßá‡¶≠‡ßá‡¶≤ 1:</strong> ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡ß≥25
          </p>
        </div>
      </div>
    </div>

    <!-- Profile Page -->
    <div id="profilePage" class="hidden">
      <div class="profile-header">
        <img id="profileAvatar" class="profile-avatar" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Profile">
        <div class="profile-name" id="userName">User Name</div>
        <div class="profile-username" id="userUsername">@username</div>
        <div class="profile-id">Nexer ID: <span id="userId">12345</span></div>
        <div class="profile-tagline" id="userLevel">Top Nexer Level 1</div>
      </div>

      <div class="card">
        <div class="stats-container">
          <div class="stat-card">
            <div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶∞‡ßá‡¶´‡¶æ‡¶∞</div>
            <div class="stat-value" id="profileRef">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ</div>
            <div class="stat-value">‡ß≥<span id="profileIncome">0</span></div>
          </div>
        </div>

        <div class="withdraw-section">
          <div class="withdraw-header" onclick="toggleWithdrawSection()">
            <h3 class="section-title">
              <i class="fas fa-money-bill-wave"></i>
              Withdraw
            </h3>
            <i class="fas fa-chevron-down" id="withdrawArrow"></i>
          </div>

          <div class="withdraw-content" id="withdrawContent">
            <p class="min-withdraw-info">‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®: ‡ß≥500 ‡¶è‡¶¨‡¶Ç 10 ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®</p>

            <form id="withdrawForm">
              <div class="form-group">
                <label for="method">‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø</label>
                <select id="method" class="form-control" required>
                  <option value="">‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                  <option value="bkash">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂</option>
                  <option value="nagad">‡¶®‡¶ó‡¶¶</option>
                </select>
              </div>

              <div class="form-group">
                <label for="number">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞</label>
                <input type="number" id="number" class="form-control" placeholder="‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶®" required>
              </div>

              <div class="form-group">
                <label for="amount">‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</label>
                <input type="number" id="amount" class="form-control" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶ü‡¶æ‡¶ï‡¶æ" min="500" required>
              </div>

              <button type="submit" class="submit-btn" id="withdrawBtn">Withdraw Request</button>
            </form>

            <p id="withdrawMsg" style="text-align: center; margin-top: 15px;"></p>
          </div>
        </div>

        <div class="admin-section hidden" id="adminSection">
          <div class="admin-header" onclick="toggleAdminSection()">
            <h3 class="section-title">
              <i class="fas fa-user-shield"></i>
              Admin Panel
            </h3>
            <i class="fas fa-chevron-down" id="adminArrow"></i>
          </div>
          <div class="admin-content" id="adminContent">
            <h4>User Session Tracking</h4>
            <table class="admin-table">
              <thead>
                <tr>
                  <th>User ID</th>
                  <th>Session Start</th>
                  <th>Duration (s)</th>
                </tr>
              </thead>
              <tbody id="sessionTable"></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="policy-section">
          <div class="policy-header" onclick="togglePolicySection()">
            <h3 class="section-title">
              <i class="fas fa-info-circle"></i>
              Policy & Rules
            </h3>
            <i class="fas fa-chevron-down" id="policyArrow"></i>
          </div>

          <div class="policy-content" id="policyContent">
            <ul class="policy-list">
              <li>‡¶è‡¶ï‡¶¶‡¶ø‡¶®‡ßá ‡ß®‡ß¶‡¶ü‡¶ø ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá‡•§</li>
              <li>‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá ‡ß®‡ß´ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá‡•§</li>
              <li>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡ß´‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶è‡¶¨‡¶Ç ‡ßß‡ß¶‡¶ü‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï‡•§</li>
              <li>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶§‡¶æ ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡¶§‡ßá ‡ß®‡ß™ ‡¶ò‡¶®‡ßç‡¶ü‡¶æ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶≤‡¶æ‡¶ó‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§</li>
              <li>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡ßã‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶π‡¶§‡ßá ‡ß®‡ß™-‡ß™‡ßÆ ‡¶ò‡¶®‡ßç‡¶ü‡¶æ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶≤‡¶æ‡¶ó‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <nav>
    <button class="nav-btn active" id="navHome" onclick="showPage('home')">
      <i class="fas fa-home"></i>
      <span>‡¶π‡ßã‡¶Æ</span>
    </button>
    <button class="nav-btn" id="navRefer" onclick="showPage('refer')">
      <i class="fas fa-user-friends"></i>
      <span>‡¶∞‡ßá‡¶´‡¶æ‡¶∞</span>
    </button>
    <button class="nav-btn" id="navProfile" onclick="showPage('profile')">
      <i class="fas fa-user"></i>
      <span>‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</span>
    </button>
  </nav>

  <!-- Notifications Panel -->
  <div class="notification-panel" id="notificationPanel">
    <div class="notification-header">
      <h3>‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®</h3>
      <button class="close-notifications" onclick="toggleNotifications()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div id="notificationsList"></div>
  </div>

  <!-- Overlay -->
  <div class="overlay" id="overlay" onclick="toggleNotifications()"></div>

  <script>
    // ========== CONFIGURATION - UPDATED FOR PAYNEX_EARNBOT ==========
    const BOT_CONFIG = {
      username: "Paynex_Earnbot",  // ‚úÖ ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ Bot Username
      token: "8452148581:AAGkseZLOKWequ7ymuWIzlFct3joP-IwZbA",
      referralBonus: 25,
      minWithdraw: 500,
      minReferralsForWithdraw: 10
    };

    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCho5RtEIoXnNlNNrpBg65BmTpJY23Se7Y",
      authDomain: "maillbeex.firebaseapp.com",
      databaseURL: "https://maillbeex-default-rtdb.firebaseio.com",
      projectId: "maillbeex",
      storageBucket: "maillbeex.firebasestorage.app",
      messagingSenderId: "5938669413",
      appId: "1:5938669413:web:34b6bbbbb0e81628a2a38c",
      measurementId: "G-F6YNLNQSK7"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const auth = firebase.auth();

    // Telegram Web App initialization
    let tg = window.Telegram.WebApp;
    tg.expand();
    tg.enableClosingConfirmation();

    // User info from Telegram
    let user = tg.initDataUnsafe.user || {
      id: 12345,
      first_name: "Demo",
      username: "demo_user",
      photo_url: "https://cdn-icons-png.flaticon.com/512/3135/3135715.png"
    };

    let uid = user.id.toString();
    let name = user.first_name + (user.last_name ? " " + user.last_name : "");
    let username = user.username ? "@" + user.username : "@user_" + uid;
    let avatarUrl = user.photo_url || "https://cdn-icons-png.flaticon.com/512/3135/3135715.png";

    // User data structure
    let userData = {
      refCount: 0,
      taskIncome: 0,
      refIncome: 0,
      totalWithdraw: 0,
      completedTasks: [],
      dailyTaskCount: 0,
      lastTaskDate: null,
      level: 1,
      notifications: [],
      referrerId: null,
      joinDate: null,
      referralBonusRate: 25,
      isActive: true
    };

    // ========== TELEGRAM BOT FUNCTIONS ==========
    async function sendTelegramMessage(chatId, text, options = {}) {
      try {
        const url = `https://api.telegram.org/bot${BOT_CONFIG.token}/sendMessage`;
        const payload = {
          chat_id: chatId,
          text: text,
          parse_mode: 'HTML',
          ...options
        };

        const response = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        const result = await response.json();
        return result.ok;
      } catch (error) {
        console.error("Telegram API Error:", error);
        return false;
      }
    }

    async function sendWelcomeMessage(userId, referrerId = null) {
      let message = `üéâ <b>‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ PayNex ‡¶è!</b>\n\n`;
      message += `üë§ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ: ${name}\n`;
      message += `üÜî ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ID: <code>${userId}</code>\n\n`;

      if (referrerId) {
        message += `ü§ù <b>‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶ú‡¶Ø‡¶º‡ßá‡¶®:</b>\n`;
        message += `‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶Ü‡¶Æ‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£ ‡¶ú‡¶æ‡¶®‡¶ø‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶® ‡¶è‡¶ï‡¶ú‡¶® ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡•§\n\n`;
      }

      message += `üí∞ <b>‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ü‡¶Ø‡¶º ‡¶ï‡¶∞‡¶¨‡ßá‡¶®:</b>\n`;
      message += `‚Ä¢ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® - ‡ß≥5/‡¶ü‡¶æ‡¶∏‡ßç‡¶ï\n`;
      message += `‚Ä¢ ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶Ü‡¶Æ‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£ ‡¶ú‡¶æ‡¶®‡¶æ‡¶® - ‡ß≥25/‡¶∞‡ßá‡¶´‡¶æ‡¶∞\n`;
      message += `‚Ä¢ ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®: ‡ß≥500\n\n`;
      message += `üöÄ ‡¶è‡¶ñ‡¶®‡¶á ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ü‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®!`;

      return await sendTelegramMessage(userId, message);
    }

    async function notifyReferrer(referrerId, newUserName, newUserId) {
      const message = `üéä <b>‡¶®‡¶§‡ßÅ‡¶® ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤!</b>\n\n`;
      message += `üë§ <b>${newUserName}</b> ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶ú‡¶Ø‡¶º‡ßá‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®!\n`;
      message += `üÜî ‡¶®‡¶§‡ßÅ‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ID: <code>${newUserId}</code>\n`;
      message += `üí∞ <b>+‡ß≥${BOT_CONFIG.referralBonus} ‡¶¨‡ßã‡¶®‡¶æ‡¶∏</b> ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!\n\n`;
      message += `üìä ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Æ‡ßã‡¶ü ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤: <b>${userData.refCount + 1}</b>\n`;
      message += `üéØ ‡¶Ü‡¶∞‡ßã ‡¶¨‡¶®‡ßç‡¶ß‡ßÅ‡¶¶‡ßá‡¶∞ ‡¶Ü‡¶Æ‡¶®‡ßç‡¶§‡ßç‡¶∞‡¶£ ‡¶ú‡¶æ‡¶®‡¶æ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶¨‡ßá‡¶∂‡¶ø ‡¶Ü‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®!`;

      return await sendTelegramMessage(referrerId, message);
    }

    // ========== REFERRAL SYSTEM ==========
    function generateReferralLink(userId) {
      return `https://t.me/${BOT_CONFIG.username}/app?startapp=ref_${userId}`;
    }

    function initializeReferralSystem() {
      console.log("üîÑ Initializing PERFECT referral system for Paynex_Earnbot user:", uid);
      
      // Update referral link
      const refLink = generateReferralLink(uid);
      document.getElementById("refLink").value = refLink;
      console.log("üîó Paynex_Earnbot Referral Link Generated:", refLink);

      // Check for referral parameter
      const initData = tg.initDataUnsafe;
      let referralId = null;

      // Check Telegram start_app parameter
      if (initData.start_app && initData.start_app.startsWith('ref_')) {
        referralId = initData.start_app.replace('ref_', '');
        console.log("‚úÖ Paynex_Earnbot Referral detected from start_app:", referralId);
      }

      // Fallback: Check URL parameters
      if (!referralId) {
        const urlParams = new URLSearchParams(window.location.search);
        const startAppParam = urlParams.get('startapp');
        if (startAppParam && startAppParam.startsWith('ref_')) {
          referralId = startAppParam.replace('ref_', '');
          console.log("‚úÖ Paynex_Earnbot Referral detected from URL startapp:", referralId);
        }
      }

      // Process referral if found
      if (referralId && referralId !== uid) {
        processPerfectReferral(referralId);
      } else {
        console.log("‚ÑπÔ∏è No Paynex_Earnbot referral detected or self-referral");
        // Send welcome message for new users
        if (!userData.joinDate) {
          sendWelcomeMessage(uid);
        }
      }

      // Start real-time referral monitoring
      startReferralMonitoring();
    }

    async function processPerfectReferral(referrerId) {
      console.log("üöÄ Processing PERFECT Paynex_Earnbot referral from:", referrerId, "to:", uid);
      
      const referralRef = database.ref(`referrals/${referrerId}/${uid}`);
      const userRef = database.ref(`users/${uid}`);
      const referrerRef = database.ref(`users/${referrerId}`);

      try {
        // Check if referral already exists
        const snapshot = await referralRef.once('value');
        if (snapshot.exists()) {
          console.log("‚ö†Ô∏è Paynex_Earnbot referral already processed");
          return;
        }

        console.log("‚úÖ New Paynex_Earnbot referral - processing...");

        // Create referral record
        const referralData = {
          referredUserId: uid,
          referrerId: referrerId,
          timestamp: firebase.database.ServerValue.TIMESTAMP,
          status: 'active',
          bonusAmount: BOT_CONFIG.referralBonus,
          referredUserName: name,
          bot: BOT_CONFIG.username
        };

        // Save referral
        await referralRef.set(referralData);
        console.log("üíæ Paynex_Earnbot referral record saved");

        // Update current user with referrer info
        await userRef.update({
          referrerId: referrerId,
          joinDate: firebase.database.ServerValue.TIMESTAMP,
          botJoined: BOT_CONFIG.username
        });

        // Update referrer's stats (transaction for atomicity)
        await referrerRef.transaction(async (referrer) => {
          if (referrer) {
            referrer.refCount = (referrer.refCount || 0) + 1;
            referrer.refIncome = (referrer.refIncome || 0) + BOT_CONFIG.referralBonus;
            
            // Update referral level
            const newLevel = Math.min(10, Math.floor(referrer.refCount / 5) + 1);
            if (newLevel > (referrer.level || 1)) {
              referrer.level = newLevel;
              referrer.referralBonusRate = 25 + (newLevel - 1) * 5; // +5 per level
            }
            
            console.log("üìä Paynex_Earnbot Referrer updated:", {
              refCount: referrer.refCount,
              refIncome: referrer.refIncome,
              level: referrer.level,
              bonusRate: referrer.referralBonusRate
            });
            
            return referrer;
          }
          return referrer;
        });

        // Send notifications
        await sendWelcomeMessage(uid, referrerId);
        await notifyReferrer(referrerId, name, uid);

        // Add system notification
        const notificationRef = database.ref('systemNotifications').push();
        await notificationRef.set({
          title: "‡¶®‡¶§‡ßÅ‡¶® Paynex_Earnbot ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤!",
          message: `${name} ${referrerId} ‡¶è‡¶∞ Paynex_Earnbot ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶ú‡¶Ø‡¶º‡ßá‡¶® ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶®‡•§`,
          timestamp: firebase.database.ServerValue.TIMESTAMP,
          type: 'referral',
          referrerId: referrerId,
          userId: uid,
          bot: BOT_CONFIG.username
        });

        // Show success message
        showNotification(`üéâ Paynex_Earnbot ‡¶è ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ${BOT_CONFIG.referralBonus}‡ß≥ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡¶æ‡¶¨‡ßá‡¶®‡•§`);

        // Update UI
        userData.refCount = (userData.refCount || 0) + 1;
        userData.refIncome = (userData.refIncome || 0) + BOT_CONFIG.referralBonus;
        updateUI();

        console.log("üéØ PERFECT Paynex_Earnbot referral completed successfully!");
        
      } catch (error) {
        console.error("‚ùå Paynex_Earnbot referral processing error:", error);
        showNotification("‚ùå Paynex_Earnbot ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
      }
    }

    function startReferralMonitoring() {
      // Real-time referral count monitoring
      const referralsRef = database.ref(`referrals/${uid}`);
      referralsRef.on('value', (snapshot) => {
        let count = 0;
        let totalIncome = 0;
        let highestLevel = 1;
        
        if (snapshot.exists()) {
          snapshot.forEach(() => count++);
          // Calculate total income and level from user data
          totalIncome = userData.refIncome || 0;
          highestLevel = userData.level || 1;
        }
        
        // Update UI in real-time
        document.getElementById("refCount").innerText = count;
        document.getElementById("refIncome").innerText = totalIncome;
        document.getElementById("profileRef").innerText = count;
        document.getElementById("refLevel").innerText = highestLevel;
        
        // Update level info
        updateLevelInfo(highestLevel);
        
        console.log(`üîÑ Paynex_Earnbot Real-time update - Referrals: ${count}, Income: ‡ß≥${totalIncome}, Level: ${highestLevel}`);
      });
    }

    function updateLevelInfo(level) {
      const levelInfo = document.getElementById("levelInfo");
      const bonusRate = 25 + (level - 1) * 5;
      levelInfo.innerHTML = `‡¶≤‡ßá‡¶≠‡ßá‡¶≤ ${level}: ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡ß≥${bonusRate}`;
    }

    // ========== FIREBASE FUNCTIONS ==========
    function loadUserData() {
      const userRef = database.ref('users/' + uid);
      
      userRef.on('value', async (snapshot) => {
        if (snapshot.exists()) {
          const data = snapshot.val();
          userData = { ...userData, ...data };
          console.log("üìä Paynex_Earnbot User data loaded:", userData);
          
          // Send welcome message for first-time users
          if (!userData.joinDate) {
            await sendWelcomeMessage(uid);
            userData.joinDate = firebase.database.ServerValue.TIMESTAMP;
            userRef.update({ joinDate: userData.joinDate });
          }
        } else {
          // Initialize new user
          userRef.set(userData);
          await sendWelcomeMessage(uid);
        }
        
        updateUI();
        loadTasks();
        loadLiveTasks();
        loadNotifications();
        loadSliderImages();
        trackUserSession();
        hideSpinner();
      });
    }

    function saveUserData() {
      const userRef = database.ref('users/' + uid);
      userRef.set(userData).catch((error) => {
        console.error("Paynex_Earnbot Error saving user data:", error);
        saveToLocalStorage();
      });
    }

    // ========== UI FUNCTIONS ==========
    function updateUI() {
      const totalBalance = userData.taskIncome + userData.refIncome - userData.totalWithdraw;
      document.getElementById("totalBalance").innerText = Math.round(totalBalance);
      document.getElementById("taskIncome").innerText = userData.taskIncome || 0;
      document.getElementById("refIncomeDetail").innerText = userData.refIncome || 0;
      document.getElementById("totalWithdraw").innerText = userData.totalWithdraw || 0;
      document.getElementById("profileIncome").innerText = Math.round(totalBalance);
      document.getElementById("userLevel").innerText = `Top Nexer Level ${userData.level || 1}`;
      
      // Update withdrawal eligibility
      updateWithdrawEligibility();
      
      console.log("üé® Paynex_Earnbot UI Updated:", {
        totalBalance,
        refCount: userData.refCount,
        refIncome: userData.refIncome,
        level: userData.level
      });
    }

    function updateWithdrawEligibility() {
      const totalBalance = userData.taskIncome + userData.refIncome - userData.totalWithdraw;
      const canWithdraw = totalBalance >= BOT_CONFIG.minWithdraw && (userData.refCount || 0) >= BOT_CONFIG.minReferralsForWithdraw;
      
      const withdrawBtn = document.getElementById("withdrawBtn");
      const minWithdrawInfo = document.querySelector(".min-withdraw-info");
      
      if (canWithdraw) {
        withdrawBtn.style.background = "var(--success)";
        withdrawBtn.innerHTML = "Withdraw Now ‚úÖ";
        minWithdrawInfo.innerHTML = `‚úÖ ‡¶Ü‡¶™‡¶®‡¶ø Paynex_Earnbot ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø! ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ: ‡ß≥${BOT_CONFIG.minWithdraw}`;
        minWithdrawInfo.style.color = "var(--success)";
      } else {
        withdrawBtn.style.background = "var(--text-secondary)";
        withdrawBtn.innerHTML = "Withdraw Locked üîí";
        withdrawBtn.disabled = true;
        
        let requirement = "";
        if (totalBalance < BOT_CONFIG.minWithdraw) {
          requirement = `‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥${Math.round(totalBalance)}/${BOT_CONFIG.minWithdraw}`;
        }
        if ((userData.refCount || 0) < BOT_CONFIG.minReferralsForWithdraw) {
          requirement += ` | ‡¶∞‡ßá‡¶´‡¶æ‡¶∞: ${userData.refCount || 0}/${BOT_CONFIG.minReferralsForWithdraw}`;
        }
        
        minWithdrawInfo.innerHTML = `üîí Paynex_Earnbot ${requirement} ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®`;
        minWithdrawInfo.style.color = "var(--warning)";
      }
    }

    function hideSpinner() {
      const spinnerOverlay = document.getElementById("spinnerOverlay");
      spinnerOverlay.style.opacity = '0';
      setTimeout(() => {
        spinnerOverlay.style.display = 'none';
      }, 500);
    }

    // ========== TASK SYSTEM ==========
    function loadTasks() {
      const tasks = [
        { id: 1, category: "registration", title: "‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡ßß ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-user-plus", reward: 5 },
        { id: 2, category: "registration", title: "‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡ß® ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-user-plus", reward: 5 },
        { id: 3, category: "registration", title: "‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡ß© ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-user-plus", reward: 5 },
        { id: 4, category: "registration", title: "‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡ß™ ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-user-plus", reward: 5 },
        { id: 5, category: "registration", title: "‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡ß´ ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-user-plus", reward: 5 },
        { id: 6, category: "appDownload", title: "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡ßß ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-download", reward: 5 },
        { id: 7, category: "appDownload", title: "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡ß® ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-download", reward: 5 },
        { id: 8, category: "appDownload", title: "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡ß© ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-download", reward: 5 },
        { id: 9, category: "appDownload", title: "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡ß™ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-download", reward: 5 },
        { id: 10, category: "appDownload", title: "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡ß´ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-download", reward: 5 },
        { id: 11, category: "survey", title: "‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡ßá ‡ßß ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-poll", reward: 5 },
        { id: 12, category: "survey", title: "‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡ßá ‡ß® ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-poll", reward: 5 },
        { id: 13, category: "survey", title: "‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡ßá ‡ß© ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-poll", reward: 5 },
        { id: 14, category: "survey", title: "‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡ßá ‡ß™ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-poll", reward: 5 },
        { id: 15, category: "survey", title: "‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡ßá ‡ß´ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-poll", reward: 5 },
        { id: 16, category: "socialMedia", title: "‡¶™‡ßã‡¶∏‡ßç‡¶ü‡ßá ‡¶≤‡¶æ‡¶á‡¶ï ‡¶¶‡¶ø‡¶®", icon: "fa-thumbs-up", reward: 5 },
        { id: 17, category: "socialMedia", title: "‡¶™‡ßã‡¶∏‡ßç‡¶ü‡ßá ‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-comment", reward: 5 },
        { id: 18, category: "socialMedia", title: "‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶¨ ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-bell", reward: 5 },
        { id: 19, category: "socialMedia", title: "‡¶ó‡ßç‡¶∞‡ßÅ‡¶™‡ßá ‡¶ú‡¶Ø‡¶º‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-users", reward: 5 },
        { id: 20, category: "socialMedia", title: "‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-share-alt", reward: 5 }
      ];
      renderTasks(tasks);
    }

    function renderTasks(tasks) {
      const containers = {
        registration: document.getElementById("registrationTasks"),
        appDownload: document.getElementById("appDownloadTasks"),
        survey: document.getElementById("surveyTasks"),
        socialMedia: document.getElementById("socialMediaTasks")
      };
      
      Object.keys(containers).forEach(category => {
        containers[category].innerHTML = "";
        tasks.filter(task => task.category === category).forEach(task => {
          let done = userData.completedTasks.includes(task.id);
          let div = document.createElement("div");
          div.className = "task-item";
          div.innerHTML = `
            <div class="task-number">${task.id}</div>
            <div class="task-icon"><i class="fas ${task.icon}"></i></div>
            <div class="task-title">${task.title}<span class="task-reward">‡ß≥${task.reward}</span></div>
            <button class="task-btn ${done ? 'completed' : ''}" onclick="completeTask(${task.id})" ${done ? 'disabled' : ''}>
              ${done ? '‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‚úÖ' : '‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®'}
            </button>
          `;
          containers[category].appendChild(div);
        });
      });
    }

    function completeTask(taskId) {
      const today = new Date().toISOString().split('T')[0];
      if (userData.lastTaskDate !== today) {
        userData.dailyTaskCount = 0;
        userData.lastTaskDate = today;
      }
      
      if (userData.dailyTaskCount >= 20) {
        showNotification("‚ö†Ô∏è ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∏‡¶¨ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∂‡ßá‡¶∑! ‡¶Ü‡¶ó‡¶æ‡¶Æ‡ßÄ‡¶ï‡¶æ‡¶≤ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
        return;
      }
      
      if (userData.completedTasks.includes(taskId)) {
        showNotification("‚úÖ ‡¶è‡¶á ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶Ü‡¶ó‡ßá ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
        return;
      }
      
      // Complete task
      userData.completedTasks.push(taskId);
      userData.taskIncome += 5;
      userData.dailyTaskCount += 1;
      
      saveUserData();
      updateUI();
      loadTasks();
      
      // Send completion notification
      sendTelegramMessage(uid, `‚úÖ <b>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®!</b>\n\n‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ID: ${taskId}\nüí∞ +‡ß≥5 ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!\n\n‡¶Æ‡ßã‡¶ü ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥${userData.taskIncome + userData.refIncome - userData.totalWithdraw}`);
      
      showNotification("üéâ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®! ‡ß≥5 ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§");
      
      // Show confetti
      showConfetti();
    }

    // ========== SHARING FUNCTIONS ==========
    function copyRef() {
      const refLink = document.getElementById("refLink");
      refLink.select();
      refLink.setSelectionRange(0, 99999);
      navigator.clipboard.writeText(refLink.value).then(() => {
        showNotification("üìã Paynex_Earnbot ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
        console.log("üìã Paynex_Earnbot Referral link copied:", refLink.value);
      }).catch(err => {
        document.execCommand("copy");
        showNotification("üìã Paynex_Earnbot ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ï‡¶™‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
        console.log("üìã Paynex_Earnbot Fallback copy successful");
      });
    }

    function shareOnFacebook() {
      const url = encodeURIComponent(document.getElementById("refLink").value);
      const text = encodeURIComponent(`PayNex ‡¶è ‡¶ú‡¶Ø‡¶º‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ü‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®! ‡¶Ü‡¶Æ‡¶æ‡¶∞ Paynex_Earnbot ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï: ${document.getElementById("refLink").value}\n\n‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤‡ßá ‡ß≥25 ‡¶¨‡ßã‡¶®‡¶æ‡¶∏! üí∞`);
      window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}&quote=${text}`, '_blank');
      showNotification("üì± Facebook ‡¶è Paynex_Earnbot ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...");
    }

    function shareOnWhatsApp() {
      const text = encodeURIComponent(`PayNex ‡¶è ‡¶ú‡¶Ø‡¶º‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ü‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®! ‡¶Ü‡¶Æ‡¶æ‡¶∞ Paynex_Earnbot ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶≤‡¶ø‡¶Ç‡¶ï: ${document.getElementById("refLink").value}\n\n‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤‡ßá ‡ß≥25 ‡¶¨‡ßã‡¶®‡¶æ‡¶∏! üí∞`);
      window.open(`https://wa.me/?text=${text}`, '_blank');
      showNotification("üì± WhatsApp ‡¶è Paynex_Earnbot ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...");
    }

    function shareOnMessenger() {
      const url = encodeURIComponent(document.getElementById("refLink").value);
      window.open(`fb-messenger://share?link=${url}`, '_blank');
      showNotification("üì± Messenger ‡¶è Paynex_Earnbot ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...");
    }

    // ========== WITHDRAWAL SYSTEM ==========
    document.getElementById("withdrawForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      
      const method = document.getElementById("method").value;
      const number = document.getElementById("number").value;
      const amount = parseInt(document.getElementById("amount").value);
      const totalBalance = userData.taskIncome + userData.refIncome - userData.totalWithdraw;
      
      // Validation
      if (totalBalance < BOT_CONFIG.minWithdraw || (userData.refCount || 0) < BOT_CONFIG.minReferralsForWithdraw) {
        document.getElementById("withdrawMsg").innerHTML = "‚ùå <strong>‡¶∂‡¶∞‡ßç‡¶§ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø!</strong><br>Paynex_Earnbot ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡ß≥500 ‡¶è‡¶¨‡¶Ç 10 ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§";
        return;
      }
      
      if (amount > totalBalance) {
        document.getElementById("withdrawMsg").innerHTML = "‚ùå <strong>‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶®‡ßá‡¶á!</strong><br>Paynex_Earnbot ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏: ‡ß≥" + Math.round(totalBalance);
        return;
      }
      
      if (amount < BOT_CONFIG.minWithdraw) {
        document.getElementById("withdrawMsg").innerHTML = "‚ùå <strong>Paynex_Earnbot ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡ß≥500</strong> ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá!";
        return;
      }
      
      const btn = document.getElementById("withdrawBtn");
      btn.disabled = true;
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏‡¶ø‡¶Ç...';
      
      try {
        // Process withdrawal
        userData.totalWithdraw += amount;
        await saveUserData();
        updateUI();
        
        // Send withdrawal confirmation
        const message = `üí∏ <b>Paynex_Earnbot ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü</b>\n\n`;
        message += `üí≥ ‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø: ${method.toUpperCase()}\n`;
        message += `üì± ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞: ${number}\n`;
        message += `üí∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£: ‡ß≥${amount}\n`;
        message += `üìÖ ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ: ${new Date().toLocaleDateString('bn-BD')}\n\n`;
        message += `‚è≥ 24-48 ‡¶ò‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶π‡¶¨‡ßá‡•§`;
        
        await sendTelegramMessage(uid, message);
        
        document.getElementById("withdrawMsg").innerHTML = `‚úÖ <strong>‡¶∏‡¶´‡¶≤!</strong><br>Paynex_Earnbot ${method} - ${number} - ‡ß≥${amount}<br>24-48 ‡¶ò‡¶®‡ßç‡¶ü‡¶æ‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶π‡¶¨‡ßá‡•§`;
        document.getElementById("withdrawForm").reset();
        
        showConfetti();
        showNotification(`üéâ Paynex_Earnbot ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶∏‡¶´‡¶≤! ‡ß≥${amount} ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§`);
        
      } catch (error) {
        console.error("Paynex_Earnbot Withdrawal error:", error);
        document.getElementById("withdrawMsg").innerHTML = "‚ùå Paynex_Earnbot ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!";
        showNotification("‚ùå Paynex_Earnbot ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!");
      } finally {
        btn.disabled = false;
        btn.innerHTML = 'Withdraw Request';
      }
    });

    // ========== UTILITY FUNCTIONS ==========
    function toggleCategory(category) {
      const content = document.getElementById(`${category}Content`);
      const arrow = document.getElementById(`${category}Arrow`);
      content.classList.toggle("active");
      arrow.classList.toggle("fa-chevron-down");
      arrow.classList.toggle("fa-chevron-up");
    }

    function toggleWithdrawSection() {
      const content = document.getElementById("withdrawContent");
      const arrow = document.getElementById("withdrawArrow");
      content.classList.toggle("active");
      arrow.classList.toggle("fa-chevron-down");
      arrow.classList.toggle("fa-chevron-up");
    }

    function togglePolicySection() {
      const content = document.getElementById("policyContent");
      const arrow = document.getElementById("policyArrow");
      content.classList.toggle("active");
      arrow.classList.toggle("fa-chevron-down");
      arrow.classList.toggle("fa-chevron-up");
    }

    function toggleNotifications() {
      const panel = document.getElementById("notificationPanel");
      const overlay = document.getElementById("overlay");
      panel.classList.toggle("active");
      overlay.classList.toggle("active");
    }

    function showNotification(message) {
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
        background: var(--card-bg); color: var(--text); padding: 12px 20px;
        border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        z-index: 10000; opacity: 0; transition: opacity 0.3s;
        font-size: 14px; max-width: 90%; text-align: center;
      `;
      toast.innerText = message;
      document.body.appendChild(toast);
      
      setTimeout(() => toast.style.opacity = '1', 10);
      setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => toast.remove(), 300);
      }, 4000);
    }

    function showConfetti() {
      const colors = ['#0088cc', '#00c2ff', '#00d66c', '#ff9500', '#ff3b30'];
      for (let i = 0; i < 50; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.cssText = `
          left: ${Math.random() * 100}vw;
          background: ${colors[Math.floor(Math.random() * colors.length)]};
          animation: confettiFall ${Math.random() * 3 + 2}s linear forwards;
        `;
        document.body.appendChild(confetti);
        setTimeout(() => confetti.remove(), 5000);
      }
    }

    function showPage(page) {
      // Hide all pages
      document.querySelectorAll('.content > div').forEach(div => div.classList.add("hidden"));
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove("active"));
      
      // Show selected page
      if (page === "home") {
        document.getElementById("homePage").classList.remove("hidden");
        document.getElementById("navHome").classList.add("active");
        loadTasks();
        loadLiveTasks();
      } else if (page === "refer") {
        document.getElementById("referPage").classList.remove("hidden");
        document.getElementById("navRefer").classList.add("active");
      } else if (page === "profile") {
        document.getElementById("profilePage").classList.remove("hidden");
        document.getElementById("navProfile").classList.add("active");
        updateWithdrawEligibility();
      }
    }

    // Track user session
    let sessionStartTime = Date.now();
    function trackUserSession() {
      window.addEventListener('beforeunload', () => {
        const duration = Math.floor((Date.now() - sessionStartTime) / 1000);
        database.ref(`userSessions/${uid}/${sessionStartTime}`).set({
          startTime: sessionStartTime,
          duration: duration,
          timestamp: firebase.database.ServerValue.TIMESTAMP,
          bot: BOT_CONFIG.username
        });
      });
    }

    // Load notifications
    function loadNotifications() {
      const notificationsRef = database.ref('systemNotifications');
      notificationsRef.orderByChild('timestamp').limitToLast(10).once('value').then((snapshot) => {
        const notificationsList = document.getElementById("notificationsList");
        notificationsList.innerHTML = "";
        
        if (snapshot.exists()) {
          const notifications = [];
          snapshot.forEach(childSnapshot => notifications.push(childSnapshot.val()));
          notifications.reverse().forEach(notification => {
            const div = document.createElement("div");
            div.className = "notification-item";
            div.innerHTML = `
              <div class="notification-title">${notification.title}</div>
              <div class="notification-message">${notification.message}</div>
              <div class="notification-time">${formatTime(notification.timestamp)}</div>
            `;
            notificationsList.appendChild(div);
          });
          document.getElementById("notificationBadge").innerText = notifications.length;
        } else {
          notificationsList.innerHTML = "<p style='text-align: center; color: var(--text-secondary);'>Paynex_Earnbot ‡¶ï‡ßã‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶®‡ßá‡¶á</p>";
        }
      });
    }

    function formatTime(timestamp) {
      if (!timestamp) return "‡¶è‡¶ñ‡¶®";
      const date = new Date(timestamp);
      return date.toLocaleDateString('bn-BD', { 
        year: 'numeric', month: 'short', day: 'numeric',
        hour: '2-digit', minute: '2-digit'
      });
    }

    // Load slider images (placeholder)
    function loadSliderImages() {
      const sliderImages = document.getElementById("sliderImages");
      sliderImages.innerHTML = `
        <div style="width: 100%;">
          <img src="https://via.placeholder.com/300x150/0088cc/ffffff?text=Paynex_Earnbot+Welcome" class="slider-image active" alt="Welcome">
        </div>
        <div style="width: 100%;">
          <img src="https://via.placeholder.com/300x150/00c2ff/ffffff?text=Earn+Money+with+Paynex_Earnbot" class="slider-image" alt="Earn Money">
        </div>
      `;
      
      // Simple slider
      setTimeout(() => {
        const images = document.querySelectorAll(".slider-image");
        let current = 0;
        setInterval(() => {
          images[current].classList.remove("active");
          current = (current + 1) % images.length;
          images[current].classList.add("active");
        }, 3000);
      }, 1000);
    }

    // Placeholder for live tasks
    function loadLiveTasks() {
      const liveTasksContainer = document.getElementById("liveTasks");
      liveTasksContainer.innerHTML = `
        <div class="task-item">
          <div class="task-number">L1</div>
          <div class="task-icon"><i class="fas fa-rocket"></i></div>
          <div class="task-title">Paynex_Earnbot ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï - ‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶Ü‡¶Ø‡¶º <span class="task-reward">‡ß≥10</span></div>
          <button class="task-btn" onclick="showNotification('üî• Paynex_Earnbot ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∂‡ßÄ‡¶ò‡ßç‡¶∞‡¶á ‡¶Ü‡¶∏‡¶õ‡ßá!')">‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡¶¨‡ßá</button>
        </div>
      `;
    }

    // Local storage fallback
    function saveToLocalStorage() {
      localStorage.setItem("userData_" + uid, JSON.stringify(userData));
    }

    function loadFromLocalStorage() {
      const saved = localStorage.getItem("userData_" + uid);
      if (saved) {
        const data = JSON.parse(saved);
        userData = { ...userData, ...data };
      }
    }

    // ========== INITIALIZATION ==========
    // Update UI with user info
    document.addEventListener('DOMContentLoaded', function() {
      console.log("üöÄ Paynex_Earnbot PERFECT Referral System Starting...");
      console.log("üë§ User:", { id: uid, name, username });
      console.log("ü§ñ Bot:", BOT_CONFIG.username);
      console.log("üîë Token:", BOT_CONFIG.token ? "Configured" : "Missing");
      
      // Set user info
      document.getElementById("userName").innerText = name;
      document.getElementById("userUsername").innerText = username;
      document.getElementById("userId").innerText = uid;
      document.getElementById("userAvatar").src = avatarUrl;
      document.getElementById("profileAvatar").src = avatarUrl;
      
      // Initialize systems
      loadFromLocalStorage();
      loadUserData();
      initializeReferralSystem();
      
      // Test referral link
      setTimeout(() => {
        console.log("üß™ Paynex_Earnbot Test Referral Link:", generateReferralLink(uid));
      }, 1000);
      
      console.log("‚úÖ Paynex_Earnbot PERFECT Referral System initialized successfully!");
    });

    // Page navigation
    function showPage(page) {
      document.querySelectorAll('.content > div').forEach(div => div.classList.add("hidden"));
      document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove("active"));
      
      if (page === "home") {
        document.getElementById("homePage").classList.remove("hidden");
        document.getElementById("navHome").classList.add("active");
        loadTasks();
        loadLiveTasks();
      } else if (page === "refer") {
        document.getElementById("referPage").classList.remove("hidden");
        document.getElementById("navRefer").classList.add("active");
      } else if (page === "profile") {
        document.getElementById("profilePage").classList.remove("hidden");
        document.getElementById("navProfile").classList.add("active");
        updateWithdrawEligibility();
      }
    }
  </script>
</body>
</html>
