<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PayNex</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #0088cc;
      --primary-dark: #006da3;
      --secondary: #121c36;
      --accent: #00c2ff;
      --success: #00d66c;
      --warning: #ff9500;
      --danger: #ff3b30;
      --text: #ffffff;
      --text-secondary: #b0b0b0;
      --card-bg: #1a243b;
      --input-bg: #23304d;
      --overlay: rgba(0, 0, 0, 0.7);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Arial, sans-serif;
    }

    body {
      background: linear-gradient(135deg, var(--secondary) 0%, #0d1425 100%);
      color: var(--text);
      min-height: 100vh;
      padding-bottom: 80px;
    }

    .spinner-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--secondary);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      opacity: 1;
      transition: opacity 0.5s ease;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid var(--primary);
      border-top: 5px solid var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    header {
      padding: 15px 20px;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: bold;
      font-size: 20px;
    }

    .logo i {
      font-size: 24px;
    }

    .header-actions {
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .notification-btn {
      background: none;
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
      position: relative;
    }

    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--danger);
      color: white;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid white;
    }

    .content {
      padding: 20px;
    }

    .section-title {
      margin-bottom: 15px;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-title i {
      color: var(--accent);
    }

    .card {
      background: var(--card-bg);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
    }

    .hero-section {
      text-align: center;
      padding: 20px 0;
    }

    .hero-slider {
      position: relative;
      width: 100%;
      max-width: 300px;
      margin: 0 auto 15px;
      overflow: hidden;
    }

    .slider-images {
      display: flex;
      width: 100%;
    }

    .slider-image {
      width: 100%;
      max-width: 300px;
      border-radius: 15px;
      display: none;
    }

    .slider-image.active {
      display: block;
    }

    .hero-title {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
      color: var(--accent);
    }

    .balance-amount {
      font-size: 32px;
      font-weight: bold;
      margin: 10px 0;
      color: var(--success);
    }

    .task-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-top: 20px;
    }

    .task-item {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      border-radius: 12px;
      padding: 15px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .task-number {
      position: absolute;
      top: 5px;
      right: 5px;
      background: rgba(255, 255, 255, 0.2);
      width: 25px;
      height: 25px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }

    .task-icon {
      font-size: 30px;
      margin-bottom: 10px;
    }

    .task-title {
      font-size: 14px;
      margin-bottom: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
    }

    .task-reward {
      font-size: 12px;
      color: var(--success);
      font-weight: bold;
    }

    .task-btn {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .task-btn:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    .task-btn.completed {
      background: var(--success);
    }

    .stats-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 15px;
      margin-top: 20px;
    }

    .stat-card {
      background: linear-gradient(135deg, #23304d 0%, #1a243b 100%);
      border-radius: 12px;
      padding: 15px;
      text-align: center;
    }

    .stat-value {
      font-size: 24px;
      font-weight: bold;
      margin: 5px 0;
      color: var(--accent);
    }

    .stat-label {
      font-size: 12px;
      color: var(--text-secondary);
    }

    .referral-link {
      display: flex;
      margin: 15px 0;
    }

    .referral-link input {
      flex: 1;
      padding: 12px 15px;
      border-radius: 8px 0 0 8px;
      border: none;
      background: var(--input-bg);
      color: var(--text);
    }

    .copy-btn {
      background: var(--primary);
      border: none;
      color: white;
      padding: 0 15px;
      border-radius: 0 8px 8px 0;
      cursor: pointer;
    }

    .share-buttons {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 20px;
    }

    .share-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: var(--input-bg);
      border: none;
      border-radius: 10px;
      padding: 10px;
      color: var(--text);
      cursor: pointer;
    }

    .share-btn i {
      font-size: 24px;
      margin-bottom: 5px;
    }

    .share-btn.facebook i {
      color: #1877f2;
    }

    .share-btn.whatsapp i {
      color: #25d366;
    }

    .share-btn.messenger i {
      color: #006aff;
    }

    .profile-header {
      text-align: center;
      margin-bottom: 20px;
    }

    .profile-avatar {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid var(--primary);
      margin: 0 auto 15px;
    }

    .profile-name {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .profile-username {
      color: var(--text-secondary);
      margin-bottom: 10px;
    }

    .profile-id {
      font-size: 14px;
      color: var(--text-secondary);
      margin-bottom: 15px;
    }

    .profile-tagline {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
      padding: 8px 15px;
      border-radius: 20px;
      display: inline-block;
      font-size: 14px;
      margin-bottom: 20px;
    }

    .withdraw-section, .admin-section {
      margin-top: 20px;
    }

    .withdraw-header, .admin-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
      cursor: pointer;
    }

    .withdraw-content, .admin-content {
      display: none;
    }

    .withdraw-content.active, .admin-content.active {
      display: block;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-size: 14px;
    }

    .form-control {
      width: 100%;
      padding: 12px 15px;
      border-radius: 8px;
      border: 1px solid var(--input-bg);
      background: var(--input-bg);
      color: var(--text);
    }

    .submit-btn {
      background: var(--primary);
      border: none;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      width: 100%;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .submit-btn:hover {
      background: var(--primary-dark);
    }

    .submit-btn:disabled {
      background: var(--text-secondary);
      cursor: not-allowed;
    }

    .min-withdraw-info {
      text-align: center;
      margin: 15px 0;
      font-size: 14px;
      color: var(--text-secondary);
    }

    .policy-section {
      margin-top: 20px;
    }

    .policy-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
      cursor: pointer;
    }

    .policy-content {
      display: none;
    }

    .policy-content.active {
      display: block;
    }

    .policy-list {
      padding-left: 20px;
    }

    .policy-list li {
      margin-bottom: 10px;
      line-height: 1.4;
    }

    nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      display: flex;
      justify-content: space-around;
      background: var(--card-bg);
      padding: 12px 0;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    }

    .nav-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .nav-btn i {
      font-size: 20px;
      margin-bottom: 5px;
    }

    .nav-btn.active {
      color: var(--primary);
    }

    .hidden {
      display: none;
    }

    .notification-panel {
      position: fixed;
      top: 0;
      right: -300px;
      width: 300px;
      height: 100%;
      background: var(--card-bg);
      z-index: 1000;
      padding: 20px;
      overflow-y: auto;
      transition: right 0.3s ease;
    }

    .notification-panel.active {
      right: 0;
    }

    .notification-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--input-bg);
    }

    .close-notifications {
      background: none;
      border: none;
      color: var(--text);
      font-size: 20px;
      cursor: pointer;
    }

    .notification-item {
      padding: 15px;
      background: var(--input-bg);
      border-radius: 10px;
      margin-bottom: 15px;
    }

    .notification-title {
      font-weight: bold;
      margin-bottom: 5px;
      color: var(--accent);
    }

    .notification-time {
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 5px;
    }

    .vote-buttons {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .vote-btn {
      background: var(--primary);
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 12px;
    }

    .vote-btn:hover {
      background: var(--primary-dark);
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--overlay);
      z-index: 999;
      display: none;
    }

    .overlay.active {
      display: block;
    }

    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      background: var(--success);
      opacity: 0;
      z-index: 1000;
      pointer-events: none;
    }

    @keyframes confettiFall {
      0% {
        transform: translateY(-100px) rotate(0deg);
        opacity: 1;
      }
      100% {
        transform: translateY(1000px) rotate(720deg);
        opacity: 0;
      }
    }

    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--card-bg);
      border-radius: 15px;
      padding: 20px;
      z-index: 1001;
      width: 90%;
      max-width: 400px;
      display: none;
    }

    .modal.active {
      display: block;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--input-bg);
    }

    .close-modal {
      background: none;
      border: none;
      color: var(--text);
      font-size: 20px;
      cursor: pointer;
    }

    .category-section {
      margin-bottom: 20px;
    }

    .category-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
      cursor: pointer;
    }

    .category-content {
      display: none;
    }

    .category-content.active {
      display: block;
    }

    .admin-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    .admin-table th, .admin-table td {
      padding: 8px;
      text-align: left;
      border-bottom: 1px solid var(--input-bg);
      font-size: 12px;
    }

    .admin-table th {
      background: var(--primary);
      color: var(--text);
    }

    .referral-history {
      margin-top: 20px;
    }

    .referral-history h3 {
      font-size: 16px;
      margin-bottom: 10px;
    }

    .referral-history ul {
      list-style: none;
      padding: 0;
    }

    .referral-history li {
      padding: 10px;
      background: var(--input-bg);
      border-radius: 8px;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    @media (max-width: 480px) {
      .task-grid {
        grid-template-columns: 1fr;
      }

      .stats-container {
        grid-template-columns: 1fr;
      }

      .share-buttons {
        grid-template-columns: repeat(2, 1fr);
      }

      .notification-panel {
        width: 85%;
        right: -85%;
      }
    }
  </style>
</head>
<body>
  <!-- Spinner Overlay -->
  <div class="spinner-overlay" id="spinnerOverlay">
    <div class="spinner"></div>
  </div>

  <header>
    <div class="logo">
      <i class="fas fa-wallet"></i>
      <span>PayNex</span>
    </div>
    <div class="header-actions">
      <button class="notification-btn" onclick="toggleNotifications()">
        <i class="fas fa-bell"></i>
        <span class="notification-badge" id="notificationBadge">0</span>
      </button>
      <img id="userAvatar" class="user-avatar" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="User">
    </div>
  </header>

  <div class="content">
    <!-- Home Page -->
    <div id="homePage">
      <div class="card">
        <div class="hero-section">
          <div class="hero-slider" id="heroSlider">
            <div class="slider-images" id="sliderImages"></div>
          </div>
          <h1 class="hero-title">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶Ø‡¶º ‡¶¨‡ßÉ‡¶¶‡ßç‡¶ß‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®</h1>
          <div class="balance-amount">‡ß≥<span id="totalBalance">0</span></div>
          <div class="stats-container">
            <div class="stat-card">
              <div class="stat-label">‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ</div>
              <div class="stat-value">‡ß≥<span id="taskIncome">0</span></div>
            </div>
            <div class="stat-card">
              <div class="stat-label">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ</div>
              <div class="stat-value">‡ß≥<span id="refIncomeDetail">0</span></div>
            </div>
            <div class="stat-card">
              <div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®</div>
              <div class="stat-value">‡ß≥<span id="totalWithdraw">0</span></div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <h2 class="section-title">
          <i class="fas fa-fire"></i>
          ‡¶≤‡¶æ‡¶á‡¶≠ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï
        </h2>
        <div class="task-grid" id="liveTasks"></div>

        <h2 class="section-title">
          <i class="fas fa-tasks"></i>
          ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï
        </h2>
        <div class="category-section">
          <div class="category-header" onclick="toggleCategory('registration')">
            <h3 class="section-title">
              <i class="fas fa-user-plus"></i>
              ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶ï‡¶∞‡ßá ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ
            </h3>
            <i class="fas fa-chevron-down" id="registrationArrow"></i>
          </div>
          <div class="category-content" id="registrationContent">
            <div class="task-grid" id="registrationTasks"></div>
          </div>
        </div>
        <div class="category-section">
          <div class="category-header" onclick="toggleCategory('appDownload')">
            <h3 class="section-title">
              <i class="fas fa-download"></i>
              ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßá ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ
            </h3>
            <i class="fas fa-chevron-down" id="appDownloadArrow"></i>
          </div>
          <div class="category-content" id="appDownloadContent">
            <div class="task-grid" id="appDownloadTasks"></div>
          </div>
        </div>
        <div class="category-section">
          <div class="category-header" onclick="toggleCategory('survey')">
            <h3 class="section-title">
              <i class="fas fa-poll"></i>
              ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡ßá ‡¶ï‡¶∞‡ßá ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ
            </h3>
            <i class="fas fa-chevron-down" id="surveyArrow"></i>
          </div>
          <div class="category-content" id="surveyContent">
            <div class="task-grid" id="surveyTasks"></div>
          </div>
        </div>
        <div class="category-section">
          <div class="category-header" onclick="toggleCategory('socialMedia')">
            <h3 class="section-title">
              <i class="fas fa-thumbs-up"></i>
              ‡¶∏‡ßã‡¶∂‡ßç‡¶Ø‡¶æ‡¶≤ ‡¶Æ‡¶ø‡¶°‡¶ø‡ßü‡¶æ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï
            </h3>
            <i class="fas fa-chevron-down" id="socialMediaArrow"></i>
          </div>
          <div class="category-content" id="socialMediaContent">
            <div class="task-grid" id="socialMediaTasks"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Refer Page -->
    <div id="referPage" class="hidden">
      <div class="card">
        <h2 class="section-title">
          <i class="fas fa-user-friends"></i>
          Referral System
        </h2>

        <div class="stats-container">
          <div class="stat-card">
            <div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶∞‡ßá‡¶´‡¶æ‡¶∞</div>
            <div class="stat-value" id="refCount">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ</div>
            <div class="stat-value">‡ß≥<span id="refIncome">0</span></div>
          </div>
        </div>

        <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Referral Link ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤‡ßá ‡ß≥25 ‡¶™‡¶æ‡¶â‡¶®!</p>

        <div class="referral-link">
          <input id="refLink" type="text" readonly>
          <button class="copy-btn" onclick="copyRef()">
            <i class="fas fa-copy"></i>
          </button>
        </div>

        <div class="share-buttons">
          <button class="share-btn facebook" onclick="shareOnFacebook()">
            <i class="fab fa-facebook"></i>
            <span>Facebook</span>
          </button>
          <button class="share-btn whatsapp" onclick="shareOnWhatsApp()">
            <i class="fab fa-whatsapp"></i>
            <span>WhatsApp</span>
          </button>
          <button class="share-btn messenger" onclick="shareOnMessenger()">
            <i class="fab fa-facebook-messenger"></i>
            <span>Messenger</span>
          </button>
        </div>

        <div class="referral-history">
          <h3>Referral History</h3>
          <ul id="referralHistory"></ul>
        </div>
      </div>
    </div>

    <!-- Profile Page -->
    <div id="profilePage" class="hidden">
      <div class="profile-header">
        <img id="profileAvatar" class="profile-avatar" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="Profile">
        <div class="profile-name" id="userName">User Name</div>
        <div class="profile-username" id="userUsername">@username</div>
        <div class="profile-id">Nexer ID: <span id="userId">12345</span></div>
        <div class="profile-tagline" id="userLevel">Top Nexer Level 5</div>
      </div>

      <div class="card">
        <div class="stats-container">
          <div class="stat-card">
            <div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶∞‡ßá‡¶´‡¶æ‡¶∞</div>
            <div class="stat-value" id="profileRef">0</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶á‡¶®‡¶ï‡¶æ‡¶Æ</div>
            <div class="stat-value">‡ß≥<span id="profileIncome">0</span></div>
          </div>
        </div>

        <div class="withdraw-section">
          <div class="withdraw-header" onclick="toggleWithdrawSection()">
            <h3 class="section-title">
              <i class="fas fa-money-bill-wave"></i>
              Withdraw
            </h3>
            <i class="fas fa-chevron-down" id="withdrawArrow"></i>
          </div>

          <div class="withdraw-content" id="withdrawContent">
            <p class="min-withdraw-info">‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶®: ‡ß≥500 ‡¶è‡¶¨‡¶Ç 10 ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®</p>

            <form id="withdrawForm">
              <div class="form-group">
                <label for="method">‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø</label>
                <select id="method" class="form-control" required>
                  <option value="">‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</option>
                  <option value="bkash">‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂</option>
                  <option value="nagad">‡¶®‡¶ó‡¶¶</option>
                </select>
              </div>

              <div class="form-group">
                <label for="number">‡¶Æ‡ßã‡¶¨‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞</label>
                <input type="number" id="number" class="form-control" placeholder="‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶®" required>
              </div>

              <div class="form-group">
                <label for="amount">‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£</label>
                <input type="number" id="amount" class="form-control" placeholder="‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶ü‡¶æ‡¶ï‡¶æ" min="500" required>
              </div>

              <button type="submit" class="submit-btn" id="withdrawBtn">Withdraw Request</button>
            </form>

            <p id="withdrawMsg" style="text-align: center; margin-top: 15px;"></p>
          </div>
        </div>

        <div class="admin-section hidden" id="adminSection">
          <div class="admin-header" onclick="toggleAdminSection()">
            <h3 class="section-title">
              <i class="fas fa-user-shield"></i>
              Admin Panel
            </h3>
            <i class="fas fa-chevron-down" id="adminArrow"></i>
          </div>
          <div class="admin-content" id="adminContent">
            <h4>User Session Tracking</h4>
            <table class="admin-table">
              <thead>
                <tr>
                  <th>User ID</th>
                  <th>Session Start</th>
                  <th>Duration (s)</th>
                </tr>
              </thead>
              <tbody id="sessionTable"></tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="policy-section">
          <div class="policy-header" onclick="togglePolicySection()">
            <h3 class="section-title">
              <i class="fas fa-info-circle"></i>
              Policy & Rules
            </h3>
            <i class="fas fa-chevron-down" id="policyArrow"></i>
          </div>

          <div class="policy-content" id="policyContent">
            <ul class="policy-list">
              <li>‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶Ö‡¶§‡¶ø‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶≠‡¶æ‡¶¨‡ßá ‡¶¨‡¶≤‡¶õ‡¶ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞‡¶æ task ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡¶§‡¶§‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶ï‡¶∞‡ßÅ‡¶® üôè‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡ßá‡¶ï task ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶Ü‡¶ö‡ßá "‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡ßá‡¶∂‡¶® " ‡¶è‡¶á ‡¶ï‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ó‡¶∞‡¶ø ‡¶§‡ßá ‡¶Ø‡ßá‡¶á task ‡¶•‡¶æ‡¶ï‡¶¨‡ßá ‡¶ì‡¶á ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶ó‡ßÅ‡¶≤‡¶æ‡¶§‡ßá ‡¶ó‡¶ø‡ßü‡ßá ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá must ‡¶®‡¶æ ‡¶π‡¶≤‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶¶‡ßá‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶Ö‡¶ü‡ßã‡¶Æ‡ßá‡¶ü‡¶ø‡¶ï ‡¶ï‡ßá‡¶ü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶Ø‡¶¶‡¶ø ‡¶∏‡¶†‡¶ø‡¶ï ‡¶≠‡¶æ‡¶¨‡ßá ‡¶ï‡¶æ‡¶ú ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá‡¶® </li>
              <li>‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá ‡ß®‡ß´ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶Ø‡ßã‡¶ó ‡¶π‡¶¨‡ßá‡•§</li>
              <li>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡ß´‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶è‡¶¨‡¶Ç ‡ßß‡ß¶‡¶ü‡¶ø ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶Ü‡¶¨‡¶∂‡ßç‡¶Ø‡¶ï‡•§</li>
              <li>‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶§‡¶æ ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡¶§‡ßá ‡ß®‡ß™ ‡¶ò‡¶®‡ßç‡¶ü‡¶æ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶≤‡¶æ‡¶ó‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§‚úîÔ∏è‡¶è‡¶¨‡¶Ç ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£‡¶§ ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá task ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶° ‡¶ï‡¶∞‡ßá ‡¶¶‡¶ø ‡¶™‡¶∞‡ßá ‡¶§‡¶æ ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶∏‡¶Æ‡ßü ‡¶®‡¶ø‡ßü‡ßá ‡¶¶‡ßá‡¶ñ‡¶ø ‡¶§‡¶æ‡¶á fake ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶≤‡ßá ‡¶¨‡¶æ fake ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶è‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶∏‡¶æ‡¶∏‡¶™‡ßá‡¶®‡ßç‡¶° ‡¶π‡¶≤‡ßá ‡¶ï‡ßá‡¶â ‡¶¶‡¶æ‡ßü‡ßÄ ‡¶•‡¶æ‡¶ï‡¶¨‡ßá ‡¶®‡¶æ </li>
              <li>‡¶â‡¶á‡¶•‡¶°‡ßç‡¶∞‡ßã‡¶∞ ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶π‡¶§‡ßá ‡ß™-‡ß≠ ‡¶ò‡¶®‡ßç‡¶ü‡¶æ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶≤‡¶æ‡¶ó‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <nav>
    <button class="nav-btn active" id="navHome" onclick="showPage('home')">
      <i class="fas fa-home"></i>
      <span>Home</span>
    </button>
    <button class="nav-btn" id="navRefer" onclick="showPage('refer')">
      <i class="fas fa-user-friends"></i>
      <span>Refer</span>
    </button>
    <button class="nav-btn" id="navProfile" onclick="showPage('profile')">
      <i class="fas fa-user"></i>
      <span>Profile</span>
    </button>
  </nav>

  <!-- Notifications Panel -->
  <div class="notification-panel" id="notificationPanel">
    <div class="notification-header">
      <h3>Notifications</h3>
      <button class="close-notifications" onclick="toggleNotifications()">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div id="notificationsList"></div>
  </div>

  <!-- Overlay -->
  <div class="overlay" id="overlay" onclick="toggleNotifications()"></div>

  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCho5RtEIoXnNlNNrpBg65BmTpJY23Se7Y",
      authDomain: "maillbeex.firebaseapp.com",
      databaseURL: "https://maillbeex-default-rtdb.firebaseio.com",
      projectId: "maillbeex",
      storageBucket: "maillbeex.firebasestorage.app",
      messagingSenderId: "5938669413",
      appId: "1:5938669413:web:34b6bbbbb0e81628a2a38c",
      measurementId: "G-F6YNLNQSK7"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const auth = firebase.auth();

    // Telegram Web App initialization
    let tg = window.Telegram.WebApp;
    tg.expand();
    tg.enableClosingConfirmation();

    // Handle Telegram Web App theme and color settings
    try {
      tg.setHeaderColor('bg_color');
      tg.setBackgroundColor('#ffffff');
      tg.onEvent('themeChanged', function() {
        document.body.style.background = tg.themeParams.bg_color || 'linear-gradient(135deg, #121c36 0%, #0d1425 100%)';
        document.querySelector('header').style.background = tg.themeParams.bg_color || '#0088cc';
      });
      tg.onEvent('viewportChanged', function() {
        tg.expand(); // Ensure the app is fully expanded
      });
    } catch (e) {
      console.warn("Error handling Telegram Web App events:", e);
    }

    // User info from Telegram
    let user = tg.initDataUnsafe.user || {
      id: 12345,
      first_name: "Demo",
      username: "demo_user",
      photo_url: "https://cdn-icons-png.flaticon.com/512/3135/3135715.png"
    };

    let uid = user.id;
    let name = user.first_name + (user.last_name ? " " + user.last_name : "");
    let username = user.username ? "@" + user.username : "@user_" + uid;
    let avatarUrl = user.photo_url || "https://cdn-icons-png.flaticon.com/512/3135/3135715.png";

    // Update UI with user info
    document.getElementById("userName").innerText = name;
    document.getElementById("userUsername").innerText = username;
    document.getElementById("userId").innerText = uid;
    document.getElementById("userAvatar").src = avatarUrl;
    document.getElementById("profileAvatar").src = avatarUrl;
    document.getElementById("refLink").value = `https://t.me/Paynex_Earnbot?start=ref_${uid}`;

    // User data
    let userData = {
      refCount: 0,
      taskIncome: 0,
      refIncome: 0,
      totalWithdraw: 0,
      completedTasks: [],
      dailyTaskCount: 0,
      lastTaskDate: null,
      level: 5,
      referralHistory: []
    };

    // Check if user is admin
    let isAdmin = false;
    auth.onAuthStateChanged((user) => {
      if (user) {
        user.getIdTokenResult().then((idTokenResult) => {
          isAdmin = idTokenResult.claims.admin === true;
          if (isAdmin) {
            document.getElementById("adminSection").classList.remove("hidden");
            loadUserSessions();
          }
        });
      }
    });

    // Track user session
    let sessionStartTime = Date.now();
    function trackUserSession() {
      window.addEventListener('beforeunload', () => {
        const sessionEndTime = Date.now();
        const duration = Math.floor((sessionEndTime - sessionStartTime) / 1000);
        const sessionRef = database.ref(`userSessions/${uid}/${sessionStartTime}`);
        sessionRef.set({
          startTime: sessionStartTime,
          duration: duration,
          timestamp: firebase.database.ServerValue.TIMESTAMP
        }).catch((error) => {
          console.error("Error saving session:", error);
        });
      });
    }

    // Load user sessions for admin panel
    function loadUserSessions() {
      const sessionsRef = database.ref('userSessions');
      sessionsRef.once('value').then((snapshot) => {
        const sessionTable = document.getElementById("sessionTable");
        sessionTable.innerHTML = "";
        if (snapshot.exists()) {
          snapshot.forEach(userSnapshot => {
            const userId = userSnapshot.key;
            userSnapshot.forEach(sessionSnapshot => {
              const session = sessionSnapshot.val();
              const row = document.createElement("tr");
              row.innerHTML = `
                <td>${userId}</td>
                <td>${formatTime(session.startTime)}</td>
                <td>${session.duration}</td>
              `;
              sessionTable.appendChild(row);
            });
          });
        } else {
          sessionTable.innerHTML = "<tr><td colspan='3'>‡¶ï‡ßã‡¶® ‡¶∏‡ßá‡¶∂‡¶® ‡¶°‡ßá‡¶ü‡¶æ ‡¶®‡ßá‡¶á</td></tr>";
        }
      }).catch((error) => {
        console.error("Error loading user sessions:", error);
      });
    }

    // Load user data from Firebase with real-time listener
    function loadUserData() {
      const userRef = database.ref('users/' + uid);
      userRef.on('value', (snapshot) => {
        if (snapshot.exists()) {
          const data = snapshot.val();
          userData = {...userData, ...data};
        } else {
          userRef.set(userData);
        }
        updateUI();
      });
      loadTasks();
      loadLiveTasks();
      loadSliderImages();
      loadNotifications();
      trackUserSession();
      hideSpinner();
    }

    // Hide spinner after content loads
    function hideSpinner() {
      const spinnerOverlay = document.getElementById("spinnerOverlay");
      spinnerOverlay.style.opacity = '0';
      setTimeout(() => {
        spinnerOverlay.style.display = 'none';
      }, 500);
    }

    // Fallback to local storage
    function loadFromLocalStorage() {
      userData.refCount = parseInt(localStorage.getItem("refCount") || 0);
      userData.taskIncome = parseInt(localStorage.getItem("taskIncome") || 0);
      userData.refIncome = parseInt(localStorage.getItem("refIncome") || 0);
      userData.totalWithdraw = parseInt(localStorage.getItem("totalWithdraw") || 0);
      userData.completedTasks = JSON.parse(localStorage.getItem("completedTasks") || '[]');
      userData.dailyTaskCount = parseInt(localStorage.getItem("dailyTaskCount") || 0);
      userData.lastTaskDate = localStorage.getItem("lastTaskDate") || null;
      userData.level = parseInt(localStorage.getItem("level") || 5);
      userData.referralHistory = JSON.parse(localStorage.getItem("referralHistory") || '[]');
    }

    // Save user data to Firebase
    function saveUserData() {
      const userRef = database.ref('users/' + uid);
      userRef.set(userData).catch((error) => {
        console.error("Error saving user data:", error);
        saveToLocalStorage();
      });
    }

    // Fallback to local storage
    function saveToLocalStorage() {
      localStorage.setItem("refCount", userData.refCount);
      localStorage.setItem("taskIncome", userData.taskIncome);
      localStorage.setItem("refIncome", userData.refIncome);
      localStorage.setItem("totalWithdraw", userData.totalWithdraw);
      localStorage.setItem("completedTasks", JSON.stringify(userData.completedTasks));
      localStorage.setItem("dailyTaskCount", userData.dailyTaskCount);
      localStorage.setItem("lastTaskDate", userData.lastTaskDate);
      localStorage.setItem("level", userData.level);
      localStorage.setItem("referralHistory", JSON.stringify(userData.referralHistory));
    }

    // Load referral history
    function loadReferralHistory() {
      const historyList = document.getElementById("referralHistory");
      historyList.innerHTML = "";
      if (userData.referralHistory && userData.referralHistory.length > 0) {
        userData.referralHistory.forEach(referral => {
          const li = document.createElement("li");
          li.innerHTML = `
            <span>${referral.name}</span>
            <span>${formatTime(referral.timestamp)}</span>
          `;
          historyList.appendChild(li);
        });
      } else {
        historyList.innerHTML = "<li>‡¶ï‡ßã‡¶® ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶π‡¶ø‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡¶ø ‡¶®‡ßá‡¶á</li>";
      }
    }

    // Load slider images from Firebase
    function loadSliderImages() {
      const sliderRef = database.ref('sliderImages');
      sliderRef.once('value').then((snapshot) => {
        const sliderImages = document.getElementById("sliderImages");
        sliderImages.innerHTML = "";
        if (snapshot.exists()) {
          const images = [];
          snapshot.forEach(childSnapshot => {
            images.push(childSnapshot.val());
          });
          images.forEach((image, index) => {
            const imgDiv = document.createElement("div");
            imgDiv.style.width = "100%";
            imgDiv.innerHTML = `<a href="${image.link}" target="_blank"><img src="${image.url}" class="slider-image ${index === 0 ? 'active' : ''}" alt="Slider Image ${index + 1}"></a>`;
            sliderImages.appendChild(imgDiv);
          });
          startSlider(images.length);
        } else {
          sliderImages.innerHTML = `<img src="https://via.placeholder.com/300x150/0088cc/ffffff?text=PayNex" class="slider-image active" alt="PayNex">`;
        }
      }).catch((error) => {
        console.error("Error loading slider images:", error);
        sliderImages.innerHTML = `<img src="https://via.placeholder.com/300x150/0088cc/ffffff?text=PayNex" class="slider-image active" alt="PayNex">`;
      });
    }

    // Start image slider
    function startSlider(imageCount) {
      if (imageCount <= 1) return;
      const images = document.querySelectorAll(".slider-image");
      let currentIndex = 0;
      setInterval(() => {
        images[currentIndex].classList.remove("active");
        currentIndex = (currentIndex + 1) % imageCount;
        images[currentIndex].classList.add("active");
      }, 5000);
    }

    // Load live tasks from Firebase
    function loadLiveTasks() {
      const liveTasksRef = database.ref('liveTasks');
      const liveTasksContainer = document.getElementById("liveTasks");
      liveTasksContainer.innerHTML = "";
      liveTasksRef.once('value').then((snapshot) => {
        if (snapshot.exists()) {
          const liveTasks = [];
          snapshot.forEach(childSnapshot => {
            liveTasks.push(childSnapshot.val());
          });
          liveTasks.forEach(task => {
            let done = userData.completedTasks.includes(task.id);
            let div = document.createElement("div");
            div.className = "task-item";
            div.innerHTML = `
              <div class="task-number">${task.id}</div>
              <div class="task-icon"><i class="fas ${task.icon}"></i></div>
              <div class="task-title">${task.title}<span class="task-reward">‡ß≥${task.reward}</span></div>
              <button class="task-btn ${done ? 'completed' : ''}" onclick="completeTask(${task.id}, '${task.link}')" ${done ? 'disabled' : ''}>
                ${done ? 'Completed' : 'Complete Now'}
              </button>
            `;
            liveTasksContainer.appendChild(div);
          });
        }
      }).catch((error) => {
        console.error("Error loading live tasks:", error);
      });
    }

    // Load tasks
    function loadTasks() {
      const tasks = [
        { id: 1, category: "registration", title: "‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡ßß ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-user-plus", reward: 5 },
        { id: 2, category: "registration", title: "‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡ß® ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-user-plus", reward: 5 },
        { id: 3, category: "registration", title: "‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡ß© ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-user-plus", reward: 5 },
        { id: 4, category: "registration", title: "‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡ß™ ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-user-plus", reward: 5 },
        { id: 5, category: "registration", title: "‡¶®‡¶§‡ßÅ‡¶® ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡ß´ ‡¶∞‡ßá‡¶ú‡¶ø‡¶∏‡ßç‡¶ü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-user-plus", reward: 5 },
        { id: 6, category: "appDownload", title: "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡ßß ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-download", reward: 5 },
        { id: 7, category: "appDownload", title: "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡ß® ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-download", reward: 5 },
        { id: 8, category: "appDownload", title: "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡ß© ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-download", reward: 5 },
        { id: 9, category: "appDownload", title: "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡ß™ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-download", reward: 5 },
        { id: 10, category: "appDownload", title: "‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡ß´ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-download", reward: 5 },
        { id: 11, category: "survey", title: "‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡ßá ‡ßß ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-poll", reward: 5 },
        { id: 12, category: "survey", title: "‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡ßá ‡ß® ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-poll", reward: 5 },
        { id: 13, category: "survey", title: "‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡ßá ‡ß© ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-poll", reward: 5 },
        { id: 14, category: "survey", title: "‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡ßá ‡ß™ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-poll", reward: 5 },
        { id: 15, category: "survey", title: "‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡ßá ‡ß´ ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-poll", reward: 5 },
        { id: 16, category: "socialMedia", title: "‡¶™‡ßã‡¶∏‡ßç‡¶ü‡ßá ‡¶≤‡¶æ‡¶á‡¶ï ‡¶¶‡¶ø‡¶®", icon: "fa-thumbs-up", reward: 5 },
        { id: 17, category: "socialMedia", title: "‡¶™‡ßã‡¶∏‡ßç‡¶ü‡ßá ‡¶ï‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-comment", reward: 5 },
        { id: 18, category: "socialMedia", title: "‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤ ‡¶∏‡¶æ‡¶¨‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶æ‡¶á‡¶¨ ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-bell", reward: 5 },
        { id: 19, category: "socialMedia", title: "‡¶ó‡ßç‡¶∞‡ßÅ‡¶™‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-users", reward: 5 },
        { id: 20, category: "socialMedia", title: "‡¶™‡ßã‡¶∏‡ßç‡¶ü ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®", icon: "fa-share-alt", reward: 5 }
      ];
      renderTasks(tasks);
    }

    // Render tasks in the UI
    function renderTasks(tasks) {
      const containers = {
        registration: document.getElementById("registrationTasks"),
        appDownload: document.getElementById("appDownloadTasks"),
        survey: document.getElementById("surveyTasks"),
        socialMedia: document.getElementById("socialMediaTasks")
      };
      Object.keys(containers).forEach(category => {
        containers[category].innerHTML = "";
        tasks.filter(task => task.category === category).forEach(task => {
          let done = userData.completedTasks.includes(task.id);
          let div = document.createElement("div");
          div.className = "task-item";
          div.innerHTML = `
            <div class="task-number">${task.id}</div>
            <div class="task-icon"><i class="fas ${task.icon}"></i></div>
            <div class="task-title">${task.title}<span class="task-reward">‡ß≥${task.reward}</span></div>
            <button class="task-btn ${done ? 'completed' : ''}" onclick="completeTask(${task.id}, 'https://otieu.com/4/9502992')" ${done ? 'disabled' : ''}>
              ${done ? 'Completed' : 'Complete Now'}
            </button>
          `;
          containers[category].appendChild(div);
        });
      });
    }

    // Complete a task
    function completeTask(taskId, link) {
      const today = new Date().toISOString().split('T')[0];
      if (userData.lastTaskDate !== today) {
        userData.dailyTaskCount = 0;
        userData.lastTaskDate = today;
      }
      if (userData.dailyTaskCount >= 20) {
        showNotification("‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∏‡¶¨ ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∂‡ßá‡¶∑!");
        return;
      }
      if (userData.completedTasks.includes(taskId)) {
        showNotification("‡¶è‡¶á ‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶Ü‡¶ó‡ßá ‡¶ï‡¶Æ‡¶™‡ßç‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
        return;
      }
      userData.completedTasks.push(taskId);
      userData.taskIncome += 5;
      userData.dailyTaskCount += 1;
      saveUserData();
      updateUI();
      loadTasks();
      loadLiveTasks();
      showNotification("‡¶ü‡¶æ‡¶∏‡ßç‡¶ï ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶® ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡ß≥5 ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§");
      window.open(link, "_blank");
    }

    // Toggle category section
    function toggleCategory(category) {
      const content = document.getElementById(`${category}Content`);
      const arrow = document.getElementById(`${category}Arrow`);
      content.classList.toggle("active");
      arrow.classList.toggle("fa-chevron-down");
      arrow.classList.toggle("fa-chevron-up");
    }

    // Toggle admin section
    function toggleAdminSection() {
      const content = document.getElementById("adminContent");
      const arrow = document.getElementById("adminArrow");
      content.classList.toggle("active");
      arrow.classList.toggle("fa-chevron-down");
      arrow.classList.toggle("fa-chevron-up");
    }

    // Copy referral link
    function copyRef() {
      let copyText = document.getElementById("refLink");
      copyText.select();
      copyText.setSelectionRange(0, 99999);
      document.execCommand("copy");
      showNotification("Referral Link ‡¶ï‡¶™‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
    }

    // Share functions
    function shareOnFacebook() {
      const url = encodeURIComponent(document.getElementById("refLink").value);
      window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, '_blank');
    }

    function shareOnWhatsApp() {
      const text = encodeURIComponent("Join PayNex and earn money! Use my referral link: ");
      const url = encodeURIComponent(document.getElementById("refLink").value);
      window.open(`https://wa.me/?text=${text}${url}`, '_blank');
    }

    function shareOnMessenger() {
      const url = encodeURIComponent(document.getElementById("refLink").value);
      window.open(`fb-messenger://share?link=${url}`, '_blank');
    }

    // Toggle sections
    function toggleWithdrawSection() {
      const content = document.getElementById("withdrawContent");
      const arrow = document.getElementById("withdrawArrow");
      content.classList.toggle("active");
      arrow.classList.toggle("fa-chevron-down");
      arrow.classList.toggle("fa-chevron-up");
    }

    function togglePolicySection() {
      const content = document.getElementById("policyContent");
      const arrow = document.getElementById("policyArrow");
      content.classList.toggle("active");
      arrow.classList.toggle("fa-chevron-down");
      arrow.classList.toggle("fa-chevron-up");
    }

    // Toggle notifications panel
    function toggleNotifications() {
      const panel = document.getElementById("notificationPanel");
      const overlay = document.getElementById("overlay");
      panel.classList.toggle("active");
      overlay.classList.toggle("active");
    }

    // Load notifications (user-specific)
    function loadNotifications() {
      const notifRef = database.ref('users/' + uid + '/notifications');
      notifRef.orderByChild('timestamp').limitToLast(10).on('value', (snapshot) => {
        const notificationsList = document.getElementById("notificationsList");
        notificationsList.innerHTML = "";
        let count = 0;
        if (snapshot.exists()) {
          const notifications = [];
          snapshot.forEach(child => {
            notifications.push({id: child.key, ...child.val()});
          });
          notifications.reverse().forEach(notification => {
            const div = document.createElement("div");
            div.className = "notification-item";
            div.innerHTML = `
              <div class="notification-title">${notification.title}</div>
              <div class="notification-message">${notification.message}</div>
              <div class="notification-time">${formatTime(notification.timestamp)}</div>
              ${notification.hasVoting ? `
                <div class="vote-buttons">
                  <button class="vote-btn" onclick="submitVote('${notification.id}', 'yes')">Yes</button>
                  <button class="vote-btn" onclick="submitVote('${notification.id}', 'no')">No</button>
                </div>
              ` : ''}
            `;
            notificationsList.appendChild(div);
            count++;
          });
        } else {
          notificationsList.innerHTML = "<p>‡¶ï‡ßã‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶®‡ßá‡¶á</p>";
        }
        document.getElementById("notificationBadge").innerText = count;
      });
    }

    // Submit vote
    function submitVote(notificationId, vote) {
      const voteRef = database.ref(`votes/${notificationId}/${uid}`);
      voteRef.set({
        vote: vote,
        timestamp: Date.now()
      }).then(() => {
        showNotification(`‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≠‡ßã‡¶ü (${vote}) ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!`);
      }).catch((error) => {
        console.error("Error submitting vote:", error);
        showNotification("‡¶≠‡ßã‡¶ü ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá!");
      });
    }

    // Format timestamp
    function formatTime(timestamp) {
      const date = new Date(timestamp);
      return date.toLocaleDateString('bn-BD') + ' ' + date.toLocaleTimeString('bn-BD');
    }

    // Withdraw form submission
    function handleWithdrawForm(e) {
      e.preventDefault();
      const method = document.getElementById("method").value;
      const number = document.getElementById("number").value;
      const amount = parseInt(document.getElementById("amount").value);
      const totalBalance = userData.taskIncome + userData.refIncome - userData.totalWithdraw;
      if (totalBalance < 500 || userData.refCount < 10) {
        document.getElementById("withdrawMsg").innerText = "‚ùå ‡¶∂‡¶∞‡ßç‡¶§ ‡¶™‡ßÇ‡¶∞‡¶£ ‡¶π‡ßü‡¶®‡¶ø! ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡ß´‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶è‡¶¨‡¶Ç ‡ßß‡ß¶ ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®‡•§";
        return;
      }
      if (amount > totalBalance) {
        document.getElementById("withdrawMsg").innerText = "‚ùå ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶™‡¶∞‡ßç‡¶Ø‡¶æ‡¶™‡ßç‡¶§ ‡¶®‡ßü!";
        return;
      }
      if (amount < 500) {
        document.getElementById("withdrawMsg").innerText = "‚ùå ‡¶®‡ßç‡¶Ø‡ßÇ‡¶®‡¶§‡¶Æ ‡ß´‡ß¶‡ß¶ ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶â‡¶§‡ßç‡¶§‡ßã‡¶≤‡¶® ‡¶ï‡¶∞‡¶§‡ßá ‡¶π‡¶¨‡ßá!";
        return;
      }
      const btn = document.getElementById("withdrawBtn");
      btn.disabled = true;
      btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
      setTimeout(() => {
        userData.totalWithdraw += amount;
        saveUserData();
        updateUI();
        document.getElementById("withdrawMsg").innerText = "‚úÖ Withdraw Request Sent (" + method + " - " + number + " - ‡ß≥" + amount + ")";
        document.getElementById("withdrawForm").reset();
        btn.disabled = false;
        btn.innerHTML = 'Withdraw Request';
        showConfetti();
      }, 2000);
    }

    // Show confetti animation
    function showConfetti() {
      const colors = ['#0088cc', '#00c2ff', '#00d66c', '#ff9500', '#ff3b30'];
      for (let i = 0; i < 50; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.animation = `confettiFall ${Math.random() * 3 + 2}s linear forwards`;
        document.body.appendChild(confetti);
        setTimeout(() => {
          confetti.remove();
        }, 5000);
      }
    }

    // Show notification toast
    function showNotification(message) {
      const toast = document.createElement('div');
      toast.style.position = 'fixed';
      toast.style.top = '20px';
      toast.style.left = '50%';
      toast.style.transform = 'translateX(-50%)';
      toast.style.backgroundColor = 'var(--card-bg)';
      toast.style.color = 'var(--text)';
      toast.style.padding = '10px 20px';
      toast.style.borderRadius = '8px';
      toast.style.boxShadow = '0 4px 15px rgba(0, 0, 0, 0.2)';
      toast.style.zIndex = '1000';
      toast.style.opacity = '0';
      toast.style.transition = 'opacity 0.3s';
      toast.innerText = message;
      document.body.appendChild(toast);
      setTimeout(() => {
        toast.style.opacity = '1';
      }, 10);
      setTimeout(() => {
        toast.style.opacity = '0';
        setTimeout(() => {
          toast.remove();
        }, 300);
      }, 3000);
    }

    // Update UI with current data
    function updateUI() {
      const totalBalance = userData.taskIncome + userData.refIncome - userData.totalWithdraw;
      document.getElementById("totalBalance").innerText = totalBalance;
      document.getElementById("taskIncome").innerText = userData.taskIncome;
      document.getElementById("refIncomeDetail").innerText = userData.refIncome;
      document.getElementById("totalWithdraw").innerText = userData.totalWithdraw;
      document.getElementById("refCount").innerText = userData.refCount;
      document.getElementById("refIncome").innerText = userData.refIncome;
      document.getElementById("profileRef").innerText = userData.refCount;
      document.getElementById("profileIncome").innerText = totalBalance;
      document.getElementById("userLevel").innerText = `Top Nexer Level ${userData.level}`;
      loadReferralHistory();
    }

    // Page navigation
    function showPage(page) {
      document.getElementById("homePage").classList.add("hidden");
      document.getElementById("referPage").classList.add("hidden");
      document.getElementById("profilePage").classList.add("hidden");
      document.getElementById("navHome").classList.remove("active");
      document.getElementById("navRefer").classList.remove("active");
      document.getElementById("navProfile").classList.remove("active");
      if (page === "home") {
        document.getElementById("homePage").classList.remove("hidden");
        document.getElementById("navHome").classList.add("active");
      } else if (page === "refer") {
        document.getElementById("referPage").classList.remove("hidden");
        document.getElementById("navRefer").classList.add("active");
      } else if (page === "profile") {
        document.getElementById("profilePage").classList.remove("hidden");
        document.getElementById("navProfile").classList.add("active");
      }
    }

    // Handle referral parameter
    function handleReferral() {
      const refParam = tg.initDataUnsafe.start_param;
      if (refParam && refParam.startsWith('ref_')) {
        const refUserId = refParam.replace('ref_', '');
        if (refUserId === uid) {
          showNotification("‡¶®‡¶ø‡¶ú‡ßá‡¶ï‡ßá ‡¶∞‡ßá‡¶´‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ!");
          return;
        }
        const refRef = database.ref('referrals/' + refUserId + '/' + uid);
        refRef.once('value').then((snapshot) => {
          if (snapshot.exists()) {
            showNotification("‡¶Ü‡¶™‡¶®‡¶ø ‡¶á‡¶§‡¶ø‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá ‡¶è‡¶á ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶®‡¶ø‡¶¨‡¶®‡ßç‡¶ß‡¶ø‡¶§!");
            return;
          }
          // Simulated IP check (client-side placeholder; server-side recommended)
          const userIp = 'simulated_ip_' + uid; // Replace with actual IP retrieval logic
          database.ref('userIps/' + uid).set({ ip: userIp }).then(() => {
            database.ref('userIps/' + refUserId).once('value').then((ipSnapshot) => {
              const referrerIp = ipSnapshot.exists() ? ipSnapshot.val().ip : null;
              if (referrerIp && referrerIp === userIp) {
                showNotification("‡¶è‡¶ï‡¶á ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏ ‡¶•‡ßá‡¶ï‡ßá ‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶ó‡ßç‡¶∞‡¶π‡¶£‡¶Ø‡ßã‡¶ó‡ßç‡¶Ø ‡¶®‡¶Ø‡¶º!");
                return;
              }
              refRef.set({
                timestamp: Date.now(),
                referredUser: uid,
                referredName: name
              }).then(() => {
                const userRef = database.ref('users/' + refUserId);
                userRef.transaction((user) => {
                  if (user) {
                    user.refCount = (user.refCount || 0) + 1;
                    user.refIncome = (user.refIncome || 0) + 25;
                    user.referralHistory = user.referralHistory || [];
                    user.referralHistory.push({
                      name: name,
                      timestamp: Date.now()
                    });
                  }
                  return user;
                }).then(() => {
                  // Notify referrer
                  database.ref('users/' + refUserId + '/notifications').push({
                    title: "New Referral",
                    message: `${name} joined using your referral link! You earned 25 BDT.`,
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    hasVoting: false
                  });
                  // Add bonus to referred user (new user)
                  const currentUserRef = database.ref('users/' + uid);
                  currentUserRef.transaction((currentUser) => {
                    if (currentUser) {
                      currentUser.refIncome = (currentUser.refIncome || 0) + 10;
                    }
                    return currentUser;
                  }).then(() => {
                    // Notify new user
                    database.ref('users/' + uid + '/notifications').push({
                      title: "Welcome to PayNex",
                      message: "You have successfully joined using a referral link and received 10 BDT signup bonus!",
                      timestamp: firebase.database.ServerValue.TIMESTAMP,
                      hasVoting: false
                    });
                    showNotification("‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‡¶Ü‡¶™‡¶®‡¶ø 10 BDT ‡¶∏‡¶æ‡¶á‡¶®‡¶Ü‡¶™ ‡¶¨‡ßã‡¶®‡¶æ‡¶∏ ‡¶™‡ßá‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡¶®‡•§");
                  });
                }).catch((error) => {
                  console.error("Error updating referrer data:", error);
                  showNotification("‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ!");
                });
              }).catch((error) => {
                console.error("Error saving referral:", error);
                showNotification("‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ!");
              });
            });
          });
        }).catch((error) => {
          console.error("Error checking referral:", error);
          showNotification("‡¶∞‡ßá‡¶´‡¶æ‡¶∞‡ßá‡¶≤ ‡¶™‡ßç‡¶∞‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶æ‡¶Ø‡¶º ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ!");
        });
      }
    }

    // Initialize the app
    function initApp() {
      document.getElementById("withdrawForm").addEventListener("submit", handleWithdrawForm);
      loadUserData();
      handleReferral();
    }

    initApp();
  </script>
</body>
</html>
