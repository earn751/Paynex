<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HiGrip - Mobile Offer Rewards</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Monetag SDK -->
    <script src='//libtl.com/sdk.js' data-zone='10087307' data-sdk='show_10087307'></script>
    <style>
        :root {
            --primary-color: #0088cc;
            --secondary-color: #f0f0f0;
            --accent-color: #ff9500;
            --text-color: #333;
            --light-text: #fff;
            --border-radius: 10px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --verified-color: #1da1f2;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: var(--text-color);
            line-height: 1.6;
            padding-bottom: 60px;
        }
        
        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
            position: relative;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        
        .tagline {
            font-size: 14px;
            color: #666;
        }
        
        .profile-section {
            position: absolute;
            right: 0;
            top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .profile-pic {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .profile-info {
            text-align: right;
        }
        
        .username {
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .verified {
            color: var(--verified-color);
            font-size: 14px;
        }
        
        .earnings {
            font-size: 12px;
            color: #666;
        }
        
        .card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--box-shadow);
        }
        
        .card-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        select, input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 16px;
        }
        
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 12px 20px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.3s;
        }
        
        .btn:hover {
            background-color: #0077b3;
        }
        
        .btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .btn-accent {
            background-color: var(--accent-color);
        }
        
        .btn-accent:hover {
            background-color: #e68500;
        }
        
        .offer-card {
            border-left: 4px solid var(--accent-color);
            margin-bottom: 15px;
            padding: 15px;
            background-color: #f9f9f9;
        }
        
        .offer-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .offer-details {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .requirements {
            font-size: 12px;
            color: #888;
            margin-bottom: 10px;
        }
        
        .progress-container {
            margin: 20px 0;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .progress-bar {
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--accent-color);
            width: 0%;
            transition: width 0.5s;
        }
        
        .timer {
            text-align: center;
            font-size: 14px;
            color: #666;
            margin-top: 10px;
        }
        
        .history-item {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .history-date {
            font-size: 12px;
            color: #888;
        }
        
        .status {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 10px;
        }
        
        .status-completed {
            background-color: #e6f7ee;
            color: #00a65a;
        }
        
        .status-pending {
            background-color: #fff8e6;
            color: #ffa500;
        }
        
        .hidden {
            display: none;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            color: white;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .notification.show {
            opacity: 1;
        }
        
        .ad-container {
            background-color: #333;
            color: white;
            padding: 20px;
            border-radius: var(--border-radius);
            text-align: center;
            margin: 20px 0;
        }
        
        .ad-text {
            margin-bottom: 15px;
        }
        
        .close-ad {
            background-color: transparent;
            border: 1px solid white;
            color: white;
            padding: 5px 10px;
            border-radius: var(--border-radius);
            cursor: pointer;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            width: 90%;
            max-width: 400px;
            box-shadow: var(--box-shadow);
        }
        
        .modal-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .modal-content {
            margin-bottom: 20px;
        }
        
        .modal-actions {
            display: flex;
            gap: 10px;
        }
        
        .referral-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .referral-title {
            font-size: 16px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }
        
        .referral-steps {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
        }
        
        .referral-step {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: var(--border-radius);
        }
        
        .step-number {
            width: 24px;
            height: 24px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
        }
        
        .step-text {
            font-size: 14px;
        }
        
        .referral-code, .referral-link {
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: var(--border-radius);
            text-align: center;
            font-family: monospace;
            font-size: 18px;
            font-weight: bold;
            margin: 10px 0;
        }
        
        .copy-btn {
            background-color: var(--accent-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            padding: 8px 15px;
            font-size: 14px;
            cursor: pointer;
            width: 100%;
        }
        
        .navigation {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: white;
            border-top: 1px solid #ddd;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #666;
            cursor: pointer;
            font-size: 14px;
        }
        
        .nav-item.active {
            color: var(--primary-color);
        }
        
        .nav-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .premium-card {
            background: linear-gradient(135deg, #ffd700, #ff9500);
            color: white;
            box-shadow: 0 6px 12px rgba(255, 149, 0, 0.3);
        }
        
        .premium-card .card-title {
            color: white;
        }
        
        .premium-card .btn {
            background-color: white;
            color: var(--accent-color);
        }
        
        .premium-card .btn:hover {
            background-color: #f0f0f0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">HiGrip</div>
            <div class="tagline">Get Mobile Data Offers & Rewards</div>
            <div class="profile-section">
                <div class="profile-info">
                    <div class="username">
                        John Doe <span class="verified">‚úì</span>
                    </div>
                    <div class="earnings">Earned: 1250 MB | Grips: 0 ‚õèÔ∏è | Referrals: 0</div>
                </div>
                <div class="profile-pic">JD</div>
            </div>
        </header>
        
        <div class="modal-overlay" id="channelModal">
            <div class="modal">
                <div class="modal-title">Join Our Channel</div>
                <div class="modal-content">
                    <p>You must join our Telegram channel to use this app:</p>
                    <a href="https://t.me/HiGripGo" target="_blank" class="btn" style="margin-top: 10px; text-decoration: none; display: inline-block;">
                        Join HiGripGo Channel
                    </a>
                </div>
                <div class="modal-actions">
                    <button class="btn" id="checkJoin">Check if Joined</button>
                </div>
            </div>
        </div>
        
        <!-- Home Section -->
        <div class="card" id="homeSection" style="display: none;">
            <div class="card-title">Enter Your Mobile Number</div>
            <div class="input-group">
                <label for="operator">Select Operator</label>
                <select id="operator">
                    <option value="">Select Operator</option>
                    <option value="banglalink">Banglalink</option>
                    <option value="airtel">Airtel</option>
                    <option value="robi">Robi</option>
                    <option value="grameenphone">Grameenphone</option>
                </select>
            </div>
            <div class="input-group">
                <label for="phoneNumber">Phone Number</label>
                <input type="text" id="phoneNumber" placeholder="01XXXXXXXXX">
            </div>
            <button id="checkOffer" class="btn">Check Offers</button>
        </div>
        
        <!-- Grip Section -->
        <div class="card" id="gripSection" style="display: none;">
            <div class="card-title">Collect Grips ‚õèÔ∏è</div>
            <div class="progress-container">
                <div class="progress-label">
                    <span>Progress</span>
                    <span id="progressText">0/10</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
            <div class="timer" id="timer">Next ad available in: 0:15</div>
            <button id="watchAd" class="btn btn-accent" disabled>Watch Ad for 1 Grip ‚õèÔ∏è</button>
            
            <div class="referral-section">
                <div class="referral-title">Share Your Referral Link</div>
                <div class="referral-link" id="referralLink">https://t.me/HiGripBot?start=HIGRIP123</div>
                <button class="copy-btn" id="copyReferralLink">Copy Referral Link</button>
            </div>
            
            <div class="card-title" style="margin-top: 20px;">Ad Watch History</div>
            <div id="historyList">
                <!-- History items will be dynamically inserted here -->
            </div>
        </div>
        
        <!-- Offer Section -->
        <div class="card" id="offersSection" style="display: none;">
            <div class="card-title">Available Offers (Up to 12GB)</div>
            <div id="offersList">
                <!-- Offers will be dynamically inserted here -->
            </div>
            
            <div class="referral-section" id="referralSection" style="display: none;">
                <div class="referral-title">Refer 3 Friends to Unlock</div>
                <div class="referral-steps">
                    <div class="referral-step">
                        <div class="step-number">1</div>
                        <div class="step-text">Share your referral link with friends</div>
                    </div>
                    <div class="referral-step">
                        <div class="step-number">2</div>
                        <div class="step-text">Your friend joins using your link</div>
                    </div>
                    <div class="referral-step">
                        <div class="step-number">3</div>
                        <div class="step-text">Your friend completes their first offer</div>
                    </div>
                    <div class="referral-step">
                        <div class="step-number">4</div>
                        <div class="step-text">You unlock the offer!</div>
                    </div>
                </div>
                <div class="referral-code" id="referralCode">HIGRIP123</div>
                <button class="copy-btn" id="copyReferral">Copy Referral Code</button>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">Notification message</div>
    
    <div class="ad-container" id="adPopup" style="display: none;">
        <div class="ad-text">Advertisement - Please watch till the end</div>
        <div id="adCountdown">Ad will complete in 10 seconds</div>
        <button class="close-ad" id="closeAd">Close Ad</button>
    </div>
    
    <div class="navigation">
        <div class="nav-item active" id="navHome">
            <span class="nav-icon">üè†</span>
            <span>Home</span>
        </div>
        <div class="nav-item" id="navGrip">
            <span class="nav-icon">‚õèÔ∏è</span>
            <span>Grip</span>
        </div>
        <div class="nav-item" id="navOffer">
            <span class="nav-icon">üéÅ</span>
            <span>Offer</span>
        </div>
    </div>

    <script>
        // Telegram Web App initialization
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();
        
        // DOM Elements
        const channelModal = document.getElementById('channelModal');
        const checkJoinBtn = document.getElementById('checkJoin');
        const homeSection = document.getElementById('homeSection');
        const gripSection = document.getElementById('gripSection');
        const offersSection = document.getElementById('offersSection');
        const checkOfferBtn = document.getElementById('checkOffer');
        const offersList = document.getElementById('offersList');
        const watchAdBtn = document.getElementById('watchAd');
        const timerElement = document.getElementById('timer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const historyList = document.getElementById('historyList');
        const notification = document.getElementById('notification');
        const adPopup = document.getElementById('adPopup');
        const closeAdBtn = document.getElementById('closeAd');
        const adCountdown = document.getElementById('adCountdown');
        const referralSection = document.getElementById('referralSection');
        const referralCode = document.getElementById('referralCode');
        const referralLink = document.getElementById('referralLink');
        const copyReferralBtn = document.getElementById('copyReferral');
        const copyReferralLinkBtn = document.getElementById('copyReferralLink');
        const navHome = document.getElementById('navHome');
        const navGrip = document.getElementById('navGrip');
        const navOffer = document.getElementById('navOffer');
        
        // App State
        let userJoinedChannel = false;
        let gripCount = 0;
        let referralCount = 0; // Real-time referral counter
        let adTimer = 15; // 15 seconds for ad unlock
        let timerInterval;
        let adCountdownValue = 10;
        let adCountdownInterval;
        let totalEarnedMB = 1250;
        let adHistory = [];
        let currentOperator = '';
        
        // Offers data
        const offers = {
            banglalink: [
                { id: 1, title: "1GB Data Offer", details: "1GB for 7 days", requirements: "10 Grips + 3 Referrals", data: "1GB", gripsRequired: 10, referralsRequired: 3 },
                { id: 2, title: "3GB Data Offer", details: "3GB for 15 days", requirements: "30 Grips + 3 Referrals", data: "3GB", gripsRequired: 30, referralsRequired: 3 },
                { id: 3, title: "6GB Data Offer", details: "6GB for 30 days", requirements: "60 Grips + 3 Referrals", data: "6GB", gripsRequired: 60, referralsRequired: 3 },
                { id: 4, title: "9GB Data Offer", details: "9GB for 30 days", requirements: "90 Grips + 3 Referrals", data: "9GB", gripsRequired: 90, referralsRequired: 3 },
                { id: 5, title: "12GB Data Offer", details: "12GB for 30 days", requirements: "120 Grips + 3 Referrals", data: "12GB", gripsRequired: 120, referralsRequired: 3 }
            ],
            airtel: [
                { id: 6, title: "1GB Data Offer", details: "1GB for 5 days", requirements: "10 Grips + 3 Referrals", data: "1GB", gripsRequired: 10, referralsRequired: 3 },
                { id: 7, title: "3GB Data Offer", details: "3GB for 10 days", requirements: "30 Grips + 3 Referrals", data: "3GB", gripsRequired: 30, referralsRequired: 3 },
                { id: 8, title: "6GB Data Offer", details: "6GB for 20 days", requirements: "60 Grips + 3 Referrals", data: "6GB", gripsRequired: 60, referralsRequired: 3 },
                { id: 9, title: "9GB Data Offer", details: "9GB for 30 days", requirements: "90 Grips + 3 Referrals", data: "9GB", gripsRequired: 90, referralsRequired: 3 },
                { id: 10, title: "12GB Data Offer", details: "12GB for 30 days", requirements: "120 Grips + 3 Referrals", data: "12GB", gripsRequired: 120, referralsRequired: 3 }
            ],
            robi: [
                { id: 11, title: "1GB Data Offer", details: "1GB for 7 days", requirements: "10 Grips + 3 Referrals", data: "1GB", gripsRequired: 10, referralsRequired: 3 },
                { id: 12, title: "3GB Data Offer", details: "3GB for 14 days", requirements: "30 Grips + 3 Referrals", data: "3GB", gripsRequired: 30, referralsRequired: 3 },
                { id: 13, title: "6GB Data Offer", details: "6GB for 30 days", requirements: "60 Grips + 3 Referrals", data: "6GB", gripsRequired: 60, referralsRequired: 3 },
                { id: 14, title: "9GB Data Offer", details: "9GB for 30 days", requirements: "90 Grips + 3 Referrals", data: "9GB", gripsRequired: 90, referralsRequired: 3 },
                { id: 15, title: "12GB Data Offer", details: "12GB for 30 days", requirements: "120 Grips + 3 Referrals", data: "12GB", gripsRequired: 120, referralsRequired: 3 }
            ],
            grameenphone: [
                { id: 16, title: "1GB Data Offer", details: "1GB for 10 days", requirements: "10 Grips + 3 Referrals", data: "1GB", gripsRequired: 10, referralsRequired: 3 },
                { id: 17, title: "3GB Data Offer", details: "3GB for 15 days", requirements: "30 Grips + 3 Referrals", data: "3GB", gripsRequired: 30, referralsRequired: 3 },
                { id: 18, title: "6GB Data Offer", details: "6GB for 30 days", requirements: "60 Grips + 3 Referrals", data: "6GB", gripsRequired: 60, referralsRequired: 3 },
                { id: 19, title: "9GB Data Offer", details: "9GB for 30 days", requirements: "90 Grips + 3 Referrals", data: "9GB", gripsRequired: 90, referralsRequired: 3 },
                { id: 20, title: "12GB Data Offer", details: "12GB for 30 days", requirements: "120 Grips + 3 Referrals", data: "12GB", gripsRequired: 120, referralsRequired: 3 }
            ]
        };
        
        // Initialize the app
        function initApp() {
            // Show channel join modal on startup
            setTimeout(() => {
                channelModal.classList.add('active');
            }, 1000);
            
            // Event listeners
            checkJoinBtn.addEventListener('click', checkChannelJoin);
            checkOfferBtn.addEventListener('click', checkOffers);
            watchAdBtn.addEventListener('click', showAd);
            closeAdBtn.addEventListener('click', closeAd);
            copyReferralBtn.addEventListener('click', copyReferralCode);
            copyReferralLinkBtn.addEventListener('click', copyReferralLink);
            
            // Navigation listeners
            navHome.addEventListener('click', () => switchSection('home'));
            navGrip.addEventListener('click', () => switchSection('grip'));
            navOffer.addEventListener('click', () => switchSection('offer'));
            
            // Load history
            renderHistory();
            
            // Start the timer for ads
            startAdTimer();
            
            // Update profile info
            updateProfileInfo();
            
            // Simulate real-time referral tracking (in real app, use Telegram bot webhook)
            checkReferralStatus();
        }
        
        // Switch between sections
        function switchSection(section) {
            homeSection.style.display = 'none';
            gripSection.style.display = 'none';
            offersSection.style.display = 'none';
            
            navHome.classList.remove('active');
            navGrip.classList.remove('active');
            navOffer.classList.remove('active');
            
            if (section === 'home') {
                homeSection.style.display = 'block';
                navHome.classList.add('active');
            } else if (section === 'grip') {
                gripSection.style.display = 'block';
                navGrip.classList.add('active');
            } else if (section === 'offer') {
                offersSection.style.display = 'block';
                navOffer.classList.add('active');
                if (currentOperator) {
                    renderOffers(offers[currentOperator] || []);
                }
            }
        }
        
        // Update profile information
        function updateProfileInfo() {
            const earningsElement = document.querySelector('.earnings');
            earningsElement.textContent = `Earned: ${totalEarnedMB} MB | Grips: ${gripCount} ‚õèÔ∏è | Referrals: ${referralCount}`;
        }
        
        // Check if user joined the channel
        function checkChannelJoin() {
            // Simulated check (in real app, use Telegram API)
            userJoinedChannel = true;
            showNotification("Successfully verified channel membership!");
            channelModal.classList.remove('active');
            switchSection('home');
        }
        
        // Check available offers based on phone number
        function checkOffers() {
            const operator = document.getElementById('operator').value;
            const phoneNumber = document.getElementById('phoneNumber').value;
            
            if (!operator) {
                showNotification("Please select an operator");
                return;
            }
            
            if (!phoneNumber || phoneNumber.length !== 11) {
                showNotification("Please enter a valid 11-digit phone number");
                return;
            }
            
            // Simulate real-time Telegram backend check
            currentOperator = operator;
            renderOffers(offers[operator] || []);
            switchSection('offer');
            showNotification(`Offers loaded for ${operator}`);
        }
        
        // Render offers to the UI
        function renderOffers(operatorOffers) {
            offersList.innerHTML = '';
            
            if (operatorOffers.length === 0) {
                offersList.innerHTML = '<p>No offers available for this number.</p>';
                return;
            }
            
            operatorOffers.forEach(offer => {
                const offerElement = document.createElement('div');
                offerElement.className = 'offer-card premium-card';
                offerElement.innerHTML = `
                    <div class="offer-title">${offer.title}</div>
                    <div class="offer-details">${offer.details}</div>
                    <div class="requirements">Requirements: ${offer.requirements}</div>
                    <button class="btn claim-btn" data-id="${offer.id}" data-mb="${parseInt(offer.data)}" data-grips="${offer.gripsRequired}" data-referrals="${offer.referralsRequired}" disabled>Claim Now</button>
                `;
                offersList.appendChild(offerElement);
            });
            
            // Add event listeners to claim buttons
            document.querySelectorAll('.claim-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const offerId = this.getAttribute('data-id');
                    const mb = parseInt(this.getAttribute('data-mb'));
                    const gripsReq = parseInt(this.getAttribute('data-grips'));
                    const referralsReq = parseInt(this.getAttribute('data-referrals'));
                    claimOffer(offerId, mb, gripsReq, referralsReq);
                });
                updateClaimButton(btn);
            });
        }
        
        // Update claim button enabled state
        function updateClaimButton(btn) {
            const gripsReq = parseInt(btn.getAttribute('data-grips'));
            const referralsReq = parseInt(btn.getAttribute('data-referrals'));
            if (gripCount >= gripsReq && referralCount >= referralsReq) {
                btn.disabled = false;
            } else {
                btn.disabled = true;
            }
        }
        
        // Claim an offer
        function claimOffer(offerId, mb, gripsReq, referralsReq) {
            if (gripCount < gripsReq || referralCount < referralsReq) {
                showNotification("Insufficient grips or referrals!");
                return;
            }
            
            gripCount -= gripsReq;
            updateProgress();
            totalEarnedMB += mb;
            updateProfileInfo();
            showNotification(`Offer ${offerId} claimed successfully! You earned ${mb} MB`);
            
            document.querySelectorAll('.claim-btn').forEach(updateClaimButton);
        }
        
        // Show ad popup with Monetag SDK
        function showAd() {
            if (watchAdBtn.disabled) return;
            
            // Load Monetag ad
            try {
                window.libtl.show_10087307(); // Trigger Monetag ad
                adPopup.style.display = 'block';
                adCountdownValue = 10;
                adCountdown.textContent = `Ad will complete in ${adCountdownValue} seconds`;
                
                adCountdownInterval = setInterval(() => {
                    adCountdownValue--;
                    adCountdown.textContent = `Ad will complete in ${adCountdownValue} seconds`;
                    
                    if (adCountdownValue <= 0) {
                        clearInterval(adCountdownInterval);
                        completeAd();
                    }
                }, 1000);
            } catch (err) {
                console.error('Failed to load ad:', err);
                showNotification("Failed to load ad. Try again.");
            }
        }
        
        // Close ad
        function closeAd() {
            clearInterval(adCountdownInterval);
            adPopup.style.display = 'none';
            showNotification("Ad closed early - no grip earned");
        }
        
        // Complete watching ad
        function completeAd() {
            clearInterval(adCountdownInterval);
            adPopup.style.display = 'none';
            
            gripCount++;
            updateProgress();
            updateProfileInfo();
            
            const now = new Date();
            const dateStr = `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            adHistory.unshift({ date: dateStr, status: "Completed" });
            renderHistory();
            
            resetAdTimer();
            
            if (gripCount >= 10 && referralSection.style.display === 'none') {
                referralSection.style.display = 'block';
                showNotification("Referral section unlocked! Refer 3 friends to claim offers.");
            }
            
            document.querySelectorAll('.claim-btn').forEach(updateClaimButton);
            showNotification("Ad completed! +1 Grip ‚õèÔ∏è");
        }
        
        // Update progress bar and text
        function updateProgress() {
            const progressPercentage = (gripCount % 10 / 10) * 100;
            progressFill.style.width = `${progressPercentage}%`;
            progressText.textContent = `${gripCount % 10}/10`;
        }
        
        // Start the ad timer
        function startAdTimer() {
            updateTimerDisplay();
            
            timerInterval = setInterval(() => {
                adTimer--;
                updateTimerDisplay();
                
                if (adTimer <= 0) {
                    watchAdBtn.disabled = false;
                    watchAdBtn.textContent = "Watch Ad for 1 Grip ‚õèÔ∏è";
                    timerElement.textContent = "Ad available now!";
                }
            }, 1000);
        }
        
        // Update timer display
        function updateTimerDisplay() {
            const minutes = Math.floor(adTimer / 60);
            const seconds = adTimer % 60;
            timerElement.textContent = `Next ad available in: ${minutes}:${seconds.toString().padStart(2, '0')}`;
        }
        
        // Reset ad timer
        function resetAdTimer() {
            adTimer = 15; // 15 seconds
            watchAdBtn.disabled = true;
            updateTimerDisplay();
        }
        
        // Render ad watch history
        function renderHistory() {
            historyList.innerHTML = '';
            
            if (adHistory.length === 0) {
                historyList.innerHTML = '<p>No ad watch history yet.</p>';
                return;
            }
            
            adHistory.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                const statusClass = item.status === 'Completed' ? 'status-completed' : 'status-pending';
                historyItem.innerHTML = `
                    <div>${item.date}</div>
                    <div class="history-date">
                        Status: <span class="status ${statusClass}">${item.status}</span>
                    </div>
                `;
                historyList.appendChild(historyItem);
            });
        }
        
        // Copy referral code
        function copyReferralCode() {
            const code = referralCode.textContent;
            navigator.clipboard.writeText(code).then(() => {
                showNotification("Referral code copied to clipboard!");
            }).catch(err => {
                console.error('Failed to copy:', err);
                showNotification("Failed to copy referral code");
            });
        }
        
        // Copy referral link
        function copyReferralLink() {
            const link = referralLink.textContent;
            navigator.clipboard.writeText(link).then(() => {
                showNotification("Referral link copied to clipboard!");
                // Simulate referral increase (in real app, track via Telegram bot)
                referralCount++;
                updateProfileInfo();
                showNotification(`Referrals: ${referralCount}/3`);
                document.querySelectorAll('.claim-btn').forEach(updateClaimButton);
            }).catch(err => {
                console.error('Failed to copy:', err);
                showNotification("Failed to copy referral link");
            });
        }
        
        // Simulate real-time referral status check
        function checkReferralStatus() {
            // In a real app, this would fetch from Telegram bot backend via API
            // For demo, we simulate referral count updates
            setInterval(() => {
                // Simulated real-time update (replace with actual Telegram bot API call)
                if (Math.random() < 0.1) { // 10% chance to simulate a new referral
                    referralCount++;
                    updateProfileInfo();
                    showNotification(`New referral! Total: ${referralCount}/3`);
                    document.querySelectorAll('.claim-btn').forEach(updateClaimButton);
                }
            }, 10000); // Check every 10 seconds
        }
        
        // Show notification
        function showNotification(message) {
            notification.textContent = message;
            notification.classList.add('show');
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
